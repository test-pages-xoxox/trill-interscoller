!function(){"use strict";function e(e,n,t,r){return new(t||(t=Promise))((function(o,d){function i(e){try{s(r.next(e))}catch(e){d(e)}}function a(e){try{s(r.throw(e))}catch(e){d(e)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,a)}s((r=r.apply(e,n||[])).next())}))}let n;const t=t=>e(void 0,void 0,void 0,(function*(){if(n)return Promise.resolve(n);const e=yield(e=>(e=>e.top!==e.self)(e)?Promise.resolve(e):new Promise((n=>{try{const t=e.document.createElement("iframe");t.src="about:blank",t.style.display="none";const r=()=>{e.document.body.appendChild(t),n(t.contentWindow)};"interactive"===document.readyState||"complete"===document.readyState?r():document.addEventListener("DOMContentLoaded",(()=>{r()}))}catch(e){n(null)}})))(t);if(!e)return Promise.reject("iframe window for datadog is null");return new Promise(((t,r)=>{const o=window.frameElement&&window.top?window.top.document:document,d=e.document.createElement("script");d.async=!0,d.src="https://www.datadoghq-browser-agent.com/datadog-logs-v4.js",d.onload=()=>{(e=>"DD_LOGS"in e)(e)?e.DD_LOGS.onReady((()=>{e.DD_LOGS.init({clientToken:"pubf9159ed47a5e0d4d8ca1f19377f88a35",site:"datadoghq.com",service:"fluct-one",forwardErrorsToLogs:!1,version:"06b79a4",env:"prod",beforeSend:e=>(e.view.url=o.location.href,e.view.referrer=o.referrer,!0)}),n=e.DD_LOGS,t(n)})):r("DD_LOGS is not found in iframe window")},d.onerror=()=>{r("error occurred while loading datadog script")},e.document.head.appendChild(d)}))}));function r(e){return{message:e.message,name:e.name,description:e.description,number:e.number,fileName:e.fileName||e.sourceURL,lineNumber:e.lineNumber||e.line,columnNumber:e.columnNumber,stack:e.stack}}const o=new class{constructor(){this.isDebugMode=!1,this.context={}}setDebugMode(e){this.isDebugMode=e}setContextProperty(e,n){this.context=Object.assign(Object.assign({},this.context),{[e]:n})}error(e,n,t=100){this.log("error",e,n,t)}warn(e,n,t=100){this.log("warn",e,n,t)}info(e,n,t=100){this.log("info",e,n,t)}debug(e,n,t=100){this.log("debug",e,n,t)}log(e,n,t,o){let d=t instanceof Error?r(t):t;d=Object.assign(Object.assign({},this.context),d);const i=o;this.sendToConsole(e,n,d),100*Math.random()<i&&this.sendToDatadog(e,n,d)}logWithError(e,n,t,o,d=100){e instanceof Error?this.log(n,t,Object.assign(Object.assign({},o),r(e)),d):this.log(n,t+"Unknown Error Occured.",Object.assign({},o),d)}sendToDatadog(e,n,r){t(window).then((t=>{t.logger.log(n,r,e)})).catch((e=>{console.error("Failed to send logs to Datadog:",e)}))}sendToConsole(e,n,t){("error"===e||this.isDebugMode)&&console[e]("%c [fluct-one]:","background-color: lightblue; color: black;",n,t)}},d=function(e,n){if("regexp"===e.type)try{const t=new RegExp(e.value);return null!==n.match(t)}catch(n){return o.logWithError(n,"error",`Invalid regexp pattern: ${e.value}.`,{pattern:e}),!1}return n.includes(e.value)};class i{constructor(e,n){this.params=e,this.url=n}check(){if(0===this.params.patterns.length)return!0;return!!this.params.patterns.find((e=>d(e,this.url)))}}class a{constructor(e,n){this.params=e,this.url=n}check(){if(0===this.params.patterns.length)return!0;return!this.params.patterns.find((e=>d(e,this.url)))}}class s{constructor(e,n){this.params=e,this.referrer=n}check(){if(0===this.params.patterns.length)return!0;return!!this.params.patterns.find((e=>d(e,this.referrer)))}}class l{constructor(e,n){this.params=e,this.referrer=n}check(){if(0===this.params.patterns.length)return!0;return!this.params.patterns.find((e=>d(e,this.referrer)))}}const c="android",u="ios";class g{constructor(e,n){this.params=e,this.ua=n}check(){let e="unknown";return/android/i.test(this.ua)&&(e=c),/iP(hone|(o|a)d)/.test(this.ua)&&(e=u),"unknown"!==e&&((e!==c||this.params.kind===c)&&(e!==u||this.params.kind===u))}}class h{constructor(e,n){this.params=e,this.ua=n}check(){const e=!!this.ua.match(/iPhone|Android.+Mobile/);return(!e||"pc"!==this.params.kind)&&!(!e&&"sp"===this.params.kind)}}class v{constructor(e,n,t,r){this.params=e,this.referrer=n,this.url=t,this.host=r}check(){var e;return this.params.displayable===function(e,n,t,r){if(!n.match(r))return!1;if(e.find((e=>d(e,t))))return!1;return!0}(null!==(e=this.params.excludePatterns)&&void 0!==e?e:[],this.referrer,this.url,this.host)}}class f{constructor(e){this.params=e}check(){const e=this.params.funcitonText,n=this.stringToFunction(e);if(!n)return!1;try{const t=n();return"boolean"!=typeof t?(o.error("customFunction: Function must return boolean",{functionText:e}),!1):t}catch(e){throw new Error(`customFunction: Failed to execute function. Error occurred. ${e}`)}}stringToFunction(e){try{const n=Function("return ("+e+")")();return"function"!=typeof n?(o.error("customFunction: Failed to convert string to function. not",{functionString:e}),null):n}catch(e){throw new Error(`customFunction: Failed to convert string to function. Error occurred. ${e}`)}}}function m(e,n={referrer:document.referrer,url:location.href,host:location.host,ua:navigator.userAgent}){const t=function(e,n){const t=[];return e.url&&t.push(new i(e.url,n.url)),e.excludeUrl&&t.push(new a(e.excludeUrl,n.url)),e.referrer&&t.push(new s(e.referrer,n.referrer)),e.excludeReferrer&&t.push(new l(e.excludeReferrer,n.referrer)),e.os&&t.push(new g(e.os,n.ua)),e.device&&t.push(new h(e.device,n.ua)),e.yda&&t.push(new v(e.yda,n.referrer,n.url,n.host)),e.customFunction&&t.push(new f(e.customFunction)),t}(e,n);for(const r of t)try{if(!r.check())return!1}catch(t){return o.logWithError(t,"error","error occurred in trigger checker",{condition:e,context:n}),!1}return!0}function p(e){const n=e.components,t=function(e){const n=e.reduce(((e,n)=>e+n),0);let t=Math.random()*n;for(let n=0;n<e.length;n++)if(t-=e[n],t<0)return n;return null}(n.map((e=>e.weight)));return null!==t?n[t]:null}function y(n,t=document){b(t)?document.write(n):function(n,t){e(this,void 0,void 0,(function*(){var e,r,o,d;void 0===t&&(t=null!==(e=document.body)&&void 0!==e?e:document.head);const i=(new DOMParser).parseFromString(n,"text/html"),a=null===(r=i.head)||void 0===r?void 0:r.children,s=null===(o=i.body)||void 0===o?void 0:o.children,l=new Uint32Array(1),c="boot-target-script-"+window.crypto.getRandomValues(l)[0];Array.prototype.forEach.call(i.getElementsByTagName("script"),(e=>{e.className=c}));const u=t;if(Array.prototype.forEach.call(a,(e=>{var n;const r=e.cloneNode(!0);null===(n=t.parentNode)||void 0===n||n.insertBefore(r,t.nextSibling),t=r})),t=u,Array.prototype.forEach.call(s,(e=>{var n;const r=e.cloneNode(!0);null===(n=t.parentNode)||void 0===n||n.insertBefore(r,t.nextSibling),t=r})),null==(null==t?void 0:t.parentNode))try{const e=10,n=100;yield function(e,n,t){return new Promise(((r,o)=>{let d=0;const i=setInterval((()=>{null!=(null==e?void 0:e.parentNode)?(clearInterval(i),r()):++d>=n&&(clearInterval(i),o(new Error("targetDOM.parentNode is null.")))}),t)}))}(t,e,n)}catch(e){throw e instanceof Error?new Error(`${e.message} targetDOM: ${t} scriptClassName: ${c}`):new Error(`error ${e}. targetDOM: ${t} scriptClassName: ${c}`)}const g=Array.prototype.slice.call(null===(d=t.parentNode)||void 0===d?void 0:d.getElementsByClassName(c)),h=[];g.forEach((e=>{const n=self.document.createElement("script");for(let t=0;t<e.attributes.length;t++){const r=e.attributes[t];n.setAttribute(r.name,r.value)}e.getAttribute("src")||(n.innerHTML=e.innerHTML),n.async=!1,h.push({s:n,original:e})})),h.forEach((e=>{var n;const t=e.s,r=e.original;null===(n=r.parentNode)||void 0===n||n.replaceChild(t,r)}))}))}(n,t.currentScript)}function b(e){const n=!e.currentScript.async,t=!!e.write.prototype;return o.setContextProperty("bootType",n||t?"documentWrite":"AsyncBoot"),n||t}function S(e){const n=new URL(document.location.href);return n.searchParams?n.searchParams.get(e):null}const O={site:{id:"54753a59-27a3-4c04-829d-eb5e6398479f",name:"dely｜trill（headタグ内に設置する）",siteCode:"trilltrill-2",triggers:[{id:"f5d4ac09-02a1-4fc1-ae88-9ee58c0c5264",title:"せぐりん用",condition:{},weightedParents:[{id:"9e9d9afd-e2dd-42cb-ba90-95caaa79f992",title:"セグリンスクリプト",components:[{id:"561d1992-7b2b-42a0-ac08-ad9d5aa974cb",title:"セグリンスクリプト",tagText:'<script src="https://cdn.sx.adingo.jp/sx.js" async><\/script>',weight:1}]}],triggerEnabled:null},{id:"fbc055fc-4229-436c-82ad-54e03ad7e990",title:"オーバーレイ枠をワンタグで管理する(iOS)",condition:{device:{kind:"sp"},os:{kind:"ios"}},weightedParents:[{id:"146ae593-ddaa-4f76-97b2-414d52e0aaee",title:"新しい比率出し分け親",components:[{id:"ff6ef9ac-235a-4e10-b1b8-d59cbbfe3fef",title:"SP_overlay 本番用（拡大なし）",tagText:"<script>\n              window.googletag = window.googletag || {\n                cmd: []\n            };\ngoogletag.cmd.push(function() {\n\n                 function overlayAdElement() {\n                    return document.querySelector('.js-overlay-ads');\n                }\n\n                function insertOverlayDiv(slot) {\n                    const div = document.createElement('div');\n                    div.id = slot.getSlotElementId();\n                    const target = overlayAdElement();\n                    target.appendChild(div);\n                }\n\n                function showOverlayAd() {\n                    const slot = getOverlaySlot();\n\n                    insertOverlayDiv(slot);\n                    googletag.display(slot);\n                }\n\n                function getOverlaySlot() {\n                    return googletag.defineSlot('/21763395206/overlay/SP_overlay', [[320, 50], [320, 100], 'fluid', [1, 1], [320, 120]], 'div-gpt-ad-1612145526142-0').addService(googletag.pubads());\n                }\n\n                if (overlayAdElement()) {\n                    if (document.readyState === 'loading') {\n                        document.addEventListener('DOMContentLoaded', function() {\n                            showOverlayAd();\n                        });\n                    } else {\n                        showOverlayAd();\n                    }\n                }\n\n\n})\n<\/script>",weight:66},{id:"9151dbb5-0968-4667-a8e0-bab3243b069e",title:"SP_overlay_c2",tagText:"<script>\n  window.googletag = window.googletag || { cmd: [] };\n  googletag.cmd.push(function() {\n    function overlayAdElement() {\n      return document.querySelector('.js-overlay-ads');\n    }\n\n    function insertOverlayDiv(slot) {\n      const div = document.createElement('div');\n      div.id = slot.getSlotElementId();\n      const target = overlayAdElement();\n      target.appendChild(div);\n    }\n\n    function showOverlayAd() {\n      const slot = getOverlaySlot();\n      insertOverlayDiv(slot);\n      googletag.display(slot);\n    }\n\n    function getOverlaySlot() {\n      return googletag.defineSlot('/21763395206/overlay/SP_overlay_c2', [[320, 50], [320, 100], [320, 120], [1, 1], 'fluid'], 'div-gpt-ad-1612145526142-0').addService(googletag.pubads());\n    }                \n    \n    if (overlayAdElement()) {\n      if (document.readyState === 'loading') {\n       document.addEventListener('DOMContentLoaded', function() {\n        showOverlayAd();\n        });\n      } else {\n        showOverlayAd();\n      }\n    }\n  })\n<\/script>",weight:20},{id:"f5f11829-724d-4fc0-9253-c383d2935b22",title:"genieeeSSPオーバーレイ(head内の必要記述)",tagText:'<script>\n  window.gnshbrequest = window.gnshbrequest || {cmd:[]};\n  window.gnshbrequest.cmd.push(function(){\n    window.gnshbrequest.forceInternalRequest();\n  });\n<\/script>\n<script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"><\/script>\n<script async src="https://cpt.geniee.jp/hb/v1/216633/836/wrapper.min.js"><\/script>',weight:1},{id:"57c4783a-d3c5-4001-b7e4-5008bdc423b1",title:"SP_overlay_c1",tagText:"<script>\n  window.googletag = window.googletag || { cmd: [] };\n  googletag.cmd.push(function() {\n    function overlayAdElement() {\n      return document.querySelector('.js-overlay-ads');\n    }\n\n    function insertOverlayDiv(slot) {\n      const div = document.createElement('div');\n      div.id = slot.getSlotElementId();\n      const target = overlayAdElement();\n      target.appendChild(div);\n    }\n\n    function showOverlayAd() {\n      const slot = getOverlaySlot();\n      insertOverlayDiv(slot);\n      googletag.display(slot);\n    }\n\n    function getOverlaySlot() {\n      return googletag.defineSlot('/21763395206/overlay/SP_overlay_c1', [[320, 50], [320, 100], [320, 120], [320,180], [320,200], [1, 1], 'fluid'], 'div-gpt-ad-1612145526142-0').addService(googletag.pubads());\n    }                \n    \n    if (overlayAdElement()) {\n      if (document.readyState === 'loading') {\n       document.addEventListener('DOMContentLoaded', function() {\n        showOverlayAd();\n        });\n      } else {\n        showOverlayAd();\n      }\n    }\n  })\n<\/script>",weight:13}]}],triggerEnabled:!0},{id:"84ceb763-567b-4d70-85e5-b408df2a2927",title:"SPオーバーレイ拡大処理",condition:{device:{kind:"sp"}},weightedParents:[{id:"6c41fbc9-3388-49bc-8226-1f82bb3d8e7a",title:"新しい比率出し分け親",components:[{id:"5f3ad144-186b-4307-b456-cfae20ca37d9",title:"C1用の拡大記載",tagText:"<script>\n  const AdingFluctGPTCreativeSizeAdjuster = function () {\n    this.targetAdUnitPaths = ['/21763395206/overlay/SP_overlay_c1'];\n  };\n\n  AdingFluctGPTCreativeSizeAdjuster.prototype = {\n    registToSlotRenderEndedEvent() {\n      googletag.cmd.push(() => {\n        googletag.pubads().addEventListener('slotRenderEnded', (e) => {\n          const { slot, size } = e;\n\n          if (this.targetAdUnitPaths.includes(slot.getAdUnitPath())) {\n            const adUnit = {\n              path: slot.getAdUnitPath(),\n              width: 320,\n            }\n            this.adjust(adUnit);\n          }\n        });\n      });\n    },\n\n    adjust(adUnit) {\n      const gptCreativeIframe = document.querySelector(`iframe[id*=\"${adUnit.path}\"]`);\n      const browserWidth = document.documentElement.clientWidth;\n\n      const scaleFactor = browserWidth / adUnit.width;\n      console.log(`ScaleTo: ${scaleFactor}`);\n\n      gptCreativeIframe.parentNode.childNodes.forEach((childNode) => {\n        const currentTransformStyle = childNode.style.transform;\n        childNode.style.transform = currentTransformStyle ? currentTransformStyle.replace(/\\d+(\\.\\d+)?/g, scaleFactor) : `scale(${scaleFactor})`;\n        childNode.style.transformOrigin = 'center bottom';\n      });\n    },\n  };\n<\/script>",weight:0}]}],triggerEnabled:null},{id:"925e838a-f830-46b0-a939-5885a7fd50f2",title:"アンカー自社広告管理（YDNポリシー是正により使用していない）",condition:{device:{kind:"sp"}},weightedParents:[{id:"b49d6160-bbd6-466d-8c40-ed2c7e3ab369",title:"自社広告を表示する関数（2024-06-24 14:00頃から）",components:[{id:"aec65d24-00f8-490d-8449-887b625d2186",title:"自社広告を表示する関数",tagText:"<script>\n  // 上部オーバーレイに自社広告を表示する関数\n  function showHeaderAnchorInHouseAd() {\n    googletag.cmd.push(() => {\n      const headerAnchorGamTagId = 'div-gpt-ad-1676254477673-0';\n      const headerAnchorElement = document.querySelector('.js-header-anker');\n\n      if (!headerAnchorElement) return;\n\n      const slot = googletag.defineSlot('/21763395206/sp_all/SP_header_anchor', [[1, 1], [2, 1], [320, 50]], headerAnchorGamTagId).addService(googletag.pubads());\n      slot.setTargeting('show_in_housead', 'true');\n      const adDiv = document.createElement('div');\n\n      adDiv.id = headerAnchorGamTagId;\n      headerAnchorElement.appendChild(adDiv);\n      googletag.pubads().refresh([slot]);\n    });\n  }\n\n  /*\n  googletag.cmd.push(() => {\n    googletag.pubads().addEventListener('slotRenderEnded', (e) => {\n      var underOverlayDivIds = ['div-gpt-ad-1612145526142-0'];\n\n      if (underOverlayDivIds.includes(e.slot.getSlotElementId())) {\n        if (!e.isEmpty) {\n          // 参考元にあったDOM操作は行わず、上部オーバーレイで自社広告を表示させる処理だけ記述する\n          document.addEventListener('DOMContentLoaded', () => {\n            // 上部オーバーレイに自社広告を出していいときは isHeaderOverlayAllowed が false のとき\n            if (typeof isHeaderOverlayAllowed === 'function' && !isHeaderOverlayAllowed(e)) {\n              showHeaderAnchorInHouseAd();\n            }\n          });\n        } else {\n          if (typeof isHeaderOverlayAllowed === 'function' && !isHeaderOverlayAllowed(e)) {\n            showHeaderAnchorInHouseAd();\n          }\n        }\n      }\n    });\n  });\n  */\n<\/script>",weight:0}]}],triggerEnabled:null},{id:"b6426bac-6ba4-4170-9aa4-0df9c96acf26",title:"オーバーレイ枠をワンタグで管理する(And)",condition:{device:{kind:"sp"},os:{kind:"android"}},weightedParents:[{id:"94cb97f9-33e6-45c9-9850-456fd35f4a64",title:"FLUXこみのオーバーレイ記述",components:[{id:"81278069-f11b-4112-84ba-4d63c4034264",title:"SP_overlay_c2",tagText:"<script>\n  window.googletag = window.googletag || { cmd: [] };\n  googletag.cmd.push(function() {\n    function overlayAdElement() {\n      return document.querySelector('.js-overlay-ads');\n    }\n\n    function insertOverlayDiv(slot) {\n      const div = document.createElement('div');\n      div.id = slot.getSlotElementId();\n      const target = overlayAdElement();\n      target.appendChild(div);\n    }\n\n    function showOverlayAd() {\n      const slot = getOverlaySlot();\n      insertOverlayDiv(slot);\n      googletag.display(slot);\n    }\n\n    function getOverlaySlot() {\n      return googletag.defineSlot('/21763395206/overlay/SP_overlay_c2', [[320, 50], [320, 100], [320, 120], [1, 1], 'fluid'], 'div-gpt-ad-1612145526142-0').addService(googletag.pubads());\n    }                \n    \n    if (overlayAdElement()) {\n      if (document.readyState === 'loading') {\n       document.addEventListener('DOMContentLoaded', function() {\n        showOverlayAd();\n        });\n      } else {\n        showOverlayAd();\n      }\n    }\n  })\n<\/script>\n\n",weight:20},{id:"2071c1c1-98dd-446e-b7af-3d8e31d98ebb",title:"genieeeSSPオーバーレイ(head内の必要記述)",tagText:'<script>\n  window.gnshbrequest = window.gnshbrequest || {cmd:[]};\n  window.gnshbrequest.cmd.push(function(){\n    window.gnshbrequest.forceInternalRequest();\n  });\n<\/script>\n<script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"><\/script>\n<script async src="https://cpt.geniee.jp/hb/v1/216633/836/wrapper.min.js"><\/script>',weight:1},{id:"a0139661-7575-4beb-adf7-b69cf49763d6",title:"SP_overlay_c1拡大用",tagText:"<script>\n  window.googletag = window.googletag || {\n    cmd: []\n  };\n  googletag.cmd.push(function() {\n  \n     function overlayAdElement() {\n        return document.querySelector('.js-overlay-ads');\n    }\n\n    function insertOverlayDiv(slot) {\n        const div = document.createElement('div');\n        div.id = slot.getSlotElementId();\n        const target = overlayAdElement();\n        target.appendChild(div);\n    }\n\n    function showOverlayAd() {\n        const slot = getOverlaySlot();\n\n        insertOverlayDiv(slot);\n        googletag.display(slot);\n    }\n\n    function getOverlaySlot() {\n        var adjuster = new AdingFluctGPTCreativeSizeAdjuster();\n        adjuster.registToSlotRenderEndedEvent();\n        return googletag.defineSlot('/21763395206/overlay/SP_overlay_c1', [[320, 50], [320, 100], [320, 120], [1, 1], 'fluid'], 'div-gpt-ad-1612145526142-0').addService(googletag.pubads());\n    }                \n    \n    if (overlayAdElement()) {\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', function() {\n                showOverlayAd();\n            });\n        } else {\n            showOverlayAd();\n        }\n    }\n  })\n<\/script>",weight:0},{id:"deeb2878-78e9-4e63-bee3-fbbc9072bb55",title:"SP_overlay_c1",tagText:"<script>\n  window.googletag = window.googletag || { cmd: [] };\n  googletag.cmd.push(function() {\n    function overlayAdElement() {\n      return document.querySelector('.js-overlay-ads');\n    }\n\n    function insertOverlayDiv(slot) {\n      const div = document.createElement('div');\n      div.id = slot.getSlotElementId();\n      const target = overlayAdElement();\n      target.appendChild(div);\n    }\n\n    function showOverlayAd() {\n      const slot = getOverlaySlot();\n      insertOverlayDiv(slot);\n      googletag.display(slot);\n    }\n\n    function getOverlaySlot() {\n      return googletag.defineSlot('/21763395206/overlay/SP_overlay_c1', [[320, 50], [320, 100], [320, 120], [320,180], [320,200], [1, 1], 'fluid'], 'div-gpt-ad-1612145526142-0').addService(googletag.pubads());\n    }                \n    \n    if (overlayAdElement()) {\n      if (document.readyState === 'loading') {\n       document.addEventListener('DOMContentLoaded', function() {\n        showOverlayAd();\n        });\n      } else {\n        showOverlayAd();\n      }\n    }\n  })\n<\/script>",weight:13},{id:"7efd9d22-66d0-4a57-b082-b05145745106",title:"開発環境用",tagText:"<script>\n              window.googletag = window.googletag || {\n                cmd: []\n            };\ngoogletag.cmd.push(function() {\n  \n                 function overlayAdElement() {\n                    return document.querySelector('.js-overlay-ads');\n                }\n\n                function insertOverlayDiv(slot) {\n                    const div = document.createElement('div');\n                    div.id = slot.getSlotElementId();\n                    const target = overlayAdElement();\n                    target.appendChild(div);\n                }\n\n                function showOverlayAd() {\n                    const slot = getOverlaySlot();\n\n                    insertOverlayDiv(slot);\n                    googletag.display(slot);\n                }\n\n                function getOverlaySlot() {\n                    var adjuster = new AdingFluctGPTCreativeSizeAdjuster();\n                    adjuster.registToSlotRenderEndedEvent();\n                    return googletag.defineSlot('/21763395206/overlay/SP_overlay', [[320, 50], [320, 100], 'fluid', [1, 1], [320, 120]], 'div-gpt-ad-1612145526142-0').addService(googletag.pubads());\n                }                \n                \n                if (overlayAdElement()) {\n                    if (document.readyState === 'loading') {\n                        document.addEventListener('DOMContentLoaded', function() {\n                            showOverlayAd();\n                        });\n                    } else {\n                        showOverlayAd();\n                    }\n                }\n                \n                \n})\n<\/script>",weight:0},{id:"e00b1aa7-38b9-402e-a122-fc762a866aa3",title:"SP_overlay 本番用（拡大なし）",tagText:"<script>\n              window.googletag = window.googletag || {\n                cmd: []\n            };\ngoogletag.cmd.push(function() {\n  \n                 function overlayAdElement() {\n                    return document.querySelector('.js-overlay-ads');\n                }\n\n                function insertOverlayDiv(slot) {\n                    const div = document.createElement('div');\n                    div.id = slot.getSlotElementId();\n                    const target = overlayAdElement();\n                    target.appendChild(div);\n                }\n\n                function showOverlayAd() {\n                    const slot = getOverlaySlot();\n\n                    insertOverlayDiv(slot);\n                    googletag.display(slot);\n                }\n\n                function getOverlaySlot() {\n                    return googletag.defineSlot('/21763395206/overlay/SP_overlay', [[320, 50], [320, 100], 'fluid', [1, 1], [320, 120]], 'div-gpt-ad-1612145526142-0').addService(googletag.pubads());\n                }                \n                \n                if (overlayAdElement()) {\n                    if (document.readyState === 'loading') {\n                        document.addEventListener('DOMContentLoaded', function() {\n                            showOverlayAd();\n                        });\n                    } else {\n                        showOverlayAd();\n                    }\n                }\n                \n                \n})\n<\/script>",weight:61},{id:"d4bd8ea3-a15d-4a9f-a687-0003c8c28974",title:"GMOSSPオーバーレイ(head内の必要記述)",tagText:'<script async src="https://cdn.gmossp-sp.jp/js/async/g944770/gc.js"><\/script>\n<script>\n  window.Gmossp=window.Gmossp||{};window.Gmossp.events=window.Gmossp.events||[];\n  window.Gmossp.events.push({\n    sid: "g944770",\n  });\n<\/script>',weight:5}]}],triggerEnabled:!0},{id:"10f1bff0-aab1-41c9-87aa-e2f36e005e01",title:"PC_下部オーバーレイ_BIDSTRAP",condition:{excludeUrl:{patterns:[{type:"string",value:"trilltrill-dev"},{type:"string",value:"articles/1027207"}]},device:{kind:"pc"}},weightedParents:[{id:"be255a09-6560-4433-8a22-05d88a4d254f",title:"新しい比率出し分け親",components:[{id:"b43c586e-9938-4369-aa75-bb4577a3dfc6",title:"【不使用】下部オーバーレイ_BIDSTRAP_リフレッシュ上限回数3回_特定LineItemでリフレッシュしない：〜2025/04/30",tagText:"<script async=\"\" src=\"https://fam.adingo.jp/bid-strap/trill/pb.js\"><\/script>\n<script>\n    var bsttag = window.bsttag || {\n        cmd: []\n    };\n\n    bsttag.failSafeTimeout = 3000;\n    bsttag.launchAuction = function (slots) {\n        var hbm = {};\n        bsttag.cmd.push(function (cmd) {\n            hbm = cmd.requestBids({\n                adUnits: slots\n            });\n        });\n\n        setTimeout(function () {\n            if (hbm.isRequestSent) {\n                return;\n            }\n\n            hbm.isRequestSent = true;\n            googletag.cmd.push(function () {\n                googletag.pubads().refresh(slots);\n            });\n        }, bsttag.failSafeTimeout);\n    }\n        ;\n<\/script>\n\n<script>\n    let pcOverlayCurrentRefreshCounts = 0\n    const PC_OVERLAY_MAX_REFRESH_COUNTS = 3;\n\n    googletag.cmd.push(\n        () => {\n            const pcOverlaySlot = googletag.defineSlot('/21763395206/overlay/PC_overlay', [[1, 1], [728, 90], 'fluid'], 'div-gpt-ad-1617861038843-0').addService(googletag.pubads());\n\n            const deniedRefreshLineItemIds = ['6978157856'];\n\n            googletag.pubads().addEventListener('slotRenderEnded', (event) => {\n                if (pcOverlayCurrentRefreshCounts >= PC_OVERLAY_MAX_REFRESH_COUNTS) {\n                    return;\n                }\n                if (deniedRefreshLineItemIds.includes(event.lineItemId)) {\n                    return\n                }\n                if (event.slot === pcOverlaySlot) {\n                    const refresh = function () {\n                        bsttag.launchAuction([pcOverlaySlot]);\n                        pcOverlayCurrentRefreshCounts++;\n                    };\n                    setTimeout(refresh, 30000);\n                }\n            })\n            bsttag.launchAuction([pcOverlaySlot]);\n        }\n    )\n<\/script>\n",weight:0},{id:"c340d2a2-2db7-4925-9dce-4e9705af613e",title:"【不使用】",tagText:"",weight:0},{id:"bb31f489-0215-4948-a2a2-7766dfca44a1",title:"【不使用】下部オーバーレイ_BIDSTRAP_リフレッシュ上限回数3回_特定LineItem & fluct/pubmatic Bidder引き当て時にリフレッシュしない：〜2025/05/14",tagText:"<script async=\"\" src=\"https://fam.adingo.jp/bid-strap/trill/pb.js\"><\/script>\n<script>\n    var bsttag = window.bsttag || {\n        cmd: []\n    };\n\n    bsttag.failSafeTimeout = 3000;\n    bsttag.launchAuction = function (slots) {\n        var hbm = {};\n        bsttag.cmd.push(function (cmd) {\n            hbm = cmd.requestBids({\n                adUnits: slots\n            });\n        });\n\n        setTimeout(function () {\n            if (hbm.isRequestSent) {\n                return;\n            }\n\n            hbm.isRequestSent = true;\n            googletag.cmd.push(function () {\n                googletag.pubads().refresh(slots);\n            });\n        }, bsttag.failSafeTimeout);\n    }\n        ;\n<\/script>\n\n<script>\n    let pcOverlayCurrentRefreshCounts = 0\n    const PC_OVERLAY_MAX_REFRESH_COUNTS = 3;\n\n    googletag.cmd.push(\n        () => {\n            const pcOverlaySlot = googletag.defineSlot('/21763395206/overlay/PC_overlay', [[1, 1], [728, 90], 'fluid'], 'div-gpt-ad-1617861038843-0').addService(googletag.pubads());\n\n            const deniedRefreshLineItemIds = [6978157856];\n            const deniedRefreshPrebidBidder = ['fluct', 'pubmatic'];\n            const pcPrebidOderId = 2980451755;\n\n            let refreshOkPrebidBidder;\n\n            // slotRequestedは確実にslotRenderEndedより先に発生する\n            // slotRequestedの時点で勝者bidderがリフレッシュ可能なbidderであるかをチェックする\n            googletag.pubads().addEventListener('slotRequested', (event) => {\n                const slot = event.slot\n                if(slot !== pcOverlaySlot){\n                    return;\n                }\n                // slot.getTargeting('fbs_bidder')の戻り値は勝者bidderの名前が1つのみ格納された、または空のArrayとなる\n                // 例: ['criteo']\n                const winPrebidBidder = slot.getTargeting('fbs_bidder')[0];\n                refreshOkPrebidBidder = deniedRefreshPrebidBidder.includes(winPrebidBidder) ? false : true;\n            })\n\n            googletag.pubads().addEventListener('slotRenderEnded', (event) => {\n                // リフレッシュ不可bidderが実際に配信された場合、以降のリフレッシュは行わない\n                if(event.campaignId === pcPrebidOderId && !refreshOkPrebidBidder){\n                    return;\n                }\n                if (pcOverlayCurrentRefreshCounts >= PC_OVERLAY_MAX_REFRESH_COUNTS) {\n                    return;\n                }\n                if (deniedRefreshLineItemIds.includes(event.lineItemId)) {\n                    return\n                }\n                if (event.slot === pcOverlaySlot) {\n                    const refresh = function () {\n                        bsttag.launchAuction([pcOverlaySlot]);\n                        pcOverlayCurrentRefreshCounts++;\n                    };\n                    setTimeout(refresh, 30000);\n                }\n            })\n            bsttag.launchAuction([pcOverlaySlot]);\n        }\n    )\n<\/script>\n",weight:0},{id:"bb812a1b-0be9-49c2-b43c-e54dca3386e9",title:"【不使用】下部オーバーレイ_BIDSTRAP",tagText:"<script async=\"\" src=\"https://fam.adingo.jp/bid-strap/trill/pb.js\"><\/script>\n<script>\n    var bsttag = window.bsttag || {\n        cmd: []\n    };\n\n    bsttag.failSafeTimeout = 3000;\n    bsttag.launchAuction = function (slots) {\n        var hbm = {};\n        bsttag.cmd.push(function (cmd) {\n            hbm = cmd.requestBids({\n                adUnits: slots\n            });\n        });\n\n        setTimeout(function () {\n            if (hbm.isRequestSent) {\n                return;\n            }\n\n            hbm.isRequestSent = true;\n            googletag.cmd.push(function () {\n                googletag.pubads().refresh(slots);\n            });\n        }, bsttag.failSafeTimeout);\n    }\n        ;\n<\/script>\n\n<script>\n    googletag.cmd.push(\n        () => {\n            const pcOverlaySlot = googletag.defineSlot('/21763395206/overlay/PC_overlay', [[1, 1], [728, 90], 'fluid'], 'div-gpt-ad-1617861038843-0').addService(googletag.pubads());\n            googletag.pubads().addEventListener('slotOnload', function (event) {\n                if (event.slot === pcOverlaySlot) {\n                    const refresh = function () {\n                        bsttag.launchAuction([pcOverlaySlot]);\n                    };\n                    setTimeout(refresh, 30000);\n                }\n            });\n            bsttag.launchAuction([pcOverlaySlot]);\n        }\n    )\n<\/script>\n",weight:0},{id:"809270f7-3d4b-46eb-89bf-a3d8b31665d7",title:"【不使用】",tagText:"<script async=\"\" src=\"https://fam.adingo.jp/bid-strap/trill/pb.js\"><\/script>\n<script>\n    var bsttag = window.bsttag || {\n        cmd: []\n    };\n\n    bsttag.failSafeTimeout = 3000;\n    bsttag.launchAuction = function (slots) {\n        var hbm = {};\n        bsttag.cmd.push(function (cmd) {\n            hbm = cmd.requestBids({\n                adUnits: slots\n            });\n        });\n\n        setTimeout(function () {\n            if (hbm.isRequestSent) {\n                return;\n            }\n\n            hbm.isRequestSent = true;\n            googletag.cmd.push(function () {\n                googletag.pubads().refresh(slots);\n            });\n        }, bsttag.failSafeTimeout);\n    }\n        ;\n<\/script>\n\n<script>\n    googletag.cmd.push(\n      () => {\n        const pcOverlaySlot = googletag.defineSlot('/21763395206/overlay/PC_overlay', [[1, 1], [728, 90], 'fluid'], 'div-gpt-ad-1617861038843-0').addService(googletag.pubads());\n        let refreshCount = 0;  // リフレッシュのカウンターを追加\n        const maxRefreshes = 3;  // リフレッシュの最大回数を設定\n\n        googletag.pubads().addEventListener('slotOnload', function (event) {\n          if (event.slot === pcOverlaySlot) {\n            const refresh = function () {\n              if (refreshCount < maxRefreshes) {\n                  bsttag.launchAuction([pcOverlaySlot]);\n                  refreshCount++;  // リフレッシュする度にカウンターを増加\n                  setTimeout(refresh, 30000);  // 30秒後に再度リフレッシュ\n              }\n            };\n            setTimeout(refresh, 30000);  // 最初のリフレッシュは初期遅延で\n          }\n        });\n        bsttag.launchAuction([pcOverlaySlot]);\n      }\n    )\n<\/script>",weight:0},{id:"0cc5511e-1d3c-4d9e-862d-e726172cd9dd",title:"【不使用】下部オーバーレイ_BIDSTRAP_MAXリフレッシュ上限回数3回：〜2025/04/23",tagText:"<script async=\"\" src=\"https://fam.adingo.jp/bid-strap/trill/pb.js\"><\/script>\n<script>\n    var bsttag = window.bsttag || {\n        cmd: []\n    };\n\n    bsttag.failSafeTimeout = 3000;\n    bsttag.launchAuction = function (slots) {\n        var hbm = {};\n        bsttag.cmd.push(function (cmd) {\n            hbm = cmd.requestBids({\n                adUnits: slots\n            });\n        });\n\n        setTimeout(function () {\n            if (hbm.isRequestSent) {\n                return;\n            }\n\n            hbm.isRequestSent = true;\n            googletag.cmd.push(function () {\n                googletag.pubads().refresh(slots);\n            });\n        }, bsttag.failSafeTimeout);\n    }\n        ;\n<\/script>\n\n<script>\n    let pcOverlayCurrentRefreshCounts = 0\n    const PC_OVERLAY_MAX_REFRESH_COUNTS = 3;\n\n    googletag.cmd.push(\n        () => {\n            const pcOverlaySlot = googletag.defineSlot('/21763395206/overlay/PC_overlay', [[1, 1], [728, 90], 'fluid'], 'div-gpt-ad-1617861038843-0').addService(googletag.pubads());\n            googletag.pubads().addEventListener('slotOnload', function (event) {\n                if(pcOverlayCurrentRefreshCounts >= PC_OVERLAY_MAX_REFRESH_COUNTS){\n                    return;\n                }\n                if (event.slot === pcOverlaySlot) {\n                    const refresh = function () {\n                        bsttag.launchAuction([pcOverlaySlot]);\n                        pcOverlayCurrentRefreshCounts++;\n                        console.log(`${pcOverlayCurrentRefreshCounts} times refreshed.`)\n                    };\n                    setTimeout(refresh, 30000);\n                }\n            });\n            bsttag.launchAuction([pcOverlaySlot]);\n        }\n    )\n<\/script>",weight:0},{id:"9ac40a1c-d184-4414-87bf-78501ed75cc1",title:"【稼働中】下部オーバーレイ_BIDSTRAP_リフレッシュ上限回数3回_特定LineItem & fluct/pubmatic BidderがCPM¥1,000以上で配信時、リフレッシュしない：2025/05/14〜",tagText:"<script async=\"\" src=\"https://fam.adingo.jp/bid-strap/trill/pb.js\"><\/script>\n<script>\n    var bsttag = window.bsttag || {\n        cmd: []\n    };\n\n    bsttag.failSafeTimeout = 3000;\n    bsttag.launchAuction = function (slots) {\n        var hbm = {};\n        bsttag.cmd.push(function (cmd) {\n            hbm = cmd.requestBids({\n                adUnits: slots\n            });\n        });\n\n        setTimeout(function () {\n            if (hbm.isRequestSent) {\n                return;\n            }\n\n            hbm.isRequestSent = true;\n            googletag.cmd.push(function () {\n                googletag.pubads().refresh(slots);\n            });\n        }, bsttag.failSafeTimeout);\n    }\n        ;\n<\/script>\n\n<script>\n    let pcOverlayCurrentRefreshCounts = 0\n    const PC_OVERLAY_MAX_REFRESH_COUNTS = 3;\n\n    googletag.cmd.push(\n        () => {\n            const pcOverlaySlot = googletag.defineSlot('/21763395206/overlay/PC_overlay', [[1, 1], [728, 90], 'fluid'], 'div-gpt-ad-1617861038843-0').addService(googletag.pubads());\n\n            const deniedRefreshLineItemIds = [6978157856];\n\n            // deniedRefreshPrebidPriceのCPM以上の入札で配信された場合、以降のrefreshを停止するbidder 5/23 'pubmatic'だけ配列から抜いた\n            const deniedRefreshPrebidBidder = ['fluct'];\n            const deniedRefreshPrebidPrice = 1000;\n\n            const pcPrebidOderId = 2980451755;\n\n            let refreshNgPrebidBidder;\n\n            // slotRequestedは確実にslotRenderEndedより先に発生する\n            // slotRequestedの時点で勝者bidderがリフレッシュ可能なbidderであるかをチェックする\n            googletag.pubads().addEventListener('slotRequested', (event) => {\n                const slot = event.slot\n                if (slot !== pcOverlaySlot) {\n                    return;\n                }\n                // slot.getTargeting('fbs_bidder')の戻り値は勝者bidderの名前が1つのみ格納された、または空のArrayとなる\n                // 例: ['criteo']\n                const winPrebidBidder = slot.getTargeting('fbs_bidder')[0];\n                // 'fbs_bidder'と同様、slot.getTargeting('fbs_pb')の戻り値は値が1つ格納された、または空のArrayとなる\n                // 例: ['15.00']\n                const winPrebidBidderPrice = parseInt(slot.getTargeting('fbs_pb')[0] || 0);\n                // 特定のbidderが指定のCPM以上の入札をしていた場合、refreshNgPrebidBidderはtrueとなる\n                refreshNgPrebidBidder =\n                    deniedRefreshPrebidBidder.includes(winPrebidBidder) && winPrebidBidderPrice >= deniedRefreshPrebidPrice;\n            })\n\n            googletag.pubads().addEventListener('slotRenderEnded', (event) => {\n                // リフレッシュ不可bidderが実際に配信された場合、以降のリフレッシュは行わない\n                if (event.campaignId === pcPrebidOderId && refreshNgPrebidBidder) {\n                    return;\n                }\n                if (pcOverlayCurrentRefreshCounts >= PC_OVERLAY_MAX_REFRESH_COUNTS) {\n                    return;\n                }\n                if (deniedRefreshLineItemIds.includes(event.lineItemId)) {\n                    return\n                }\n                if (event.slot === pcOverlaySlot) {\n                    const refresh = function () {\n                        bsttag.launchAuction([pcOverlaySlot]);\n                        pcOverlayCurrentRefreshCounts++;\n                    };\n                    setTimeout(refresh, 30000);\n                }\n            })\n            bsttag.launchAuction([pcOverlaySlot]);\n        }\n    )\n<\/script>\n",weight:1}]}],triggerEnabled:!0},{id:"56aa4413-279e-44a1-a22c-46688dec80e2",title:"DataCurrent",condition:{customFunction:{funcitonText:"function () {\n  var frequency_interval_day = 7; // 7日間\n  var frequency_cookie_name = 'adingo_datacarrent_frequency';\n\n  var getCookie = function(name) {\n    var value = null;\n    var cookiename = name + '=';\n    var allcookies = document.cookie;\n    var position = allcookies.indexOf(cookiename);\n    if (position !== -1) {\n      var startindex = position + cookiename.length;\n      var endindex = allcookies.indexOf(';', startindex);\n      if (endindex == -1) {\n        endindex = allcookies.length;\n      }\n      value = decodeURIComponent(allcookies.substring(startindex, endindex));\n    }\n    return value;\n  }\n\n  var setCookie = function(name, data, day) {\n    var expire = new Date();\n    expire.setTime(expire.getTime() + 1000 * 60 * 60 * 24 * day);\n    document.cookie = name + '=' + encodeURIComponent(data) + '; path=/; expires=' + expire.toUTCString();\n  }\n\n  var setIntervalCookie = function() {\n    setCookie(frequency_cookie_name, 'true', frequency_interval_day);\n  }\n\n  var isOverInterval = function() {\n    var frequency = getCookie(frequency_cookie_name);\n    return frequency !== 'true';\n  }\n\n  // 一度表示したら一定日数非表示\n  if (isOverInterval()) {\n    setIntervalCookie();\n    return true;\n  }\n\n  return false;\n}"}},weightedParents:[{id:"7f2cf16b-6cb8-4ca4-a001-8a25c51a43a5",title:"DataCurrent",components:[{id:"4a7134a9-5f29-4150-8441-3af8d3558f95",title:"【DCTM】DataCurrent 3rd party リタゲ",tagText:'\x3c!-- DCTM --\x3e\n<script src="https://cdn.id5-sync.com/api/1.0/id5-api.js"><\/script>\n<script type="text/javascript">\n!function(t,e){if(void 0===e[t]){e[t]=function(){e[t].clients.push(this),this._init=[Array.prototype.slice.call(arguments)]},e[t].clients=[];for(var s=["addRecord","blockEvents","fetchServerCookie","fetchGlobalID","fetchUserSegments","resetUUID","ready","setSignedMode","setAnonymousMode","set","trackEvent","trackPageview","trackClicks","unblockEvents"],c=0;c<s.length;c++){var r=s[c];e[t].prototype[r]=function(t){return function(){return this["_"+t]=this["_"+t]||[],this["_"+t].push(Array.prototype.slice.call(arguments)),this}}(r)}var n=document.createElement("script"),o=(n.type="text/javascript",n.async=!0,n.src=("https:"===document.location.protocol?"https:":"http:")+"//al-s.dc-tag.jp/dcam.min.js",document.getElementsByTagName("script")[0]);o.parentNode.insertBefore(n,o)}}("DCAccessMeasure",this);\n<\/script>\n\n<script type="text/javascript">\nvar CCIDT = window.CCIDT || {};\n\n(function() {\n  function setDCAM(id5Id) {\n    function getmeta(t){\n      try {\n        var l_key = t.toLowerCase();\n        var u_key = t.toUpperCase();\n        var cc_key = t[0].toUpperCase() + t.slice(1).toLowerCase();\n\n        var headChildren = document.head.children || {};\n        var meta_kw_node = headChildren[l_key] || headChildren[u_key] || headChildren[cc_key];\n\n        var md = "";\n        if(meta_kw_node){md = meta_kw_node.getAttribute(\'content\')};\n\n      }catch(e) {\n        var md = "";\n      }\n      return md;\n    }\n\n    var dcam = new DCAccessMeasure({\n      host: \'al-a.dc-tag.jp\',\n      writeKey: \'K2AU08J9LDC48H3\',\n      database: \'dc_access_log\',\n      startInSignedMode: true\n    });\n\n    var dcam_table = \'fluct_non_ex\';\n\n    CCIDT.custom_data_fluct =  window.CCIDT.custom_data_fluct || {};\n    try { CCIDT.custom_data_fluct[\'fluct_uid\'] = localStorage.getItem(\'fluctUID\'); } catch(e) {}\n\n    dcam.set(dcam_table, \'dcam_global_id\', \'dcam_global_id\');\n    dcam.set(dcam_table, {\n      id5: id5Id || \'\',\n      meta_kw: getmeta(\'keywords\'),\n      custom_data: CCIDT.custom_data_fluct,\n    });\n\n    dcam.trackPageview(dcam_table);\n  }\n\n  var check_localStorage = function(k){\n    try{\n      var id5StringEncoded = window.localStorage.getItem(k);\n      if(id5StringEncoded){\n        var id5StringDecoded = decodeURIComponent(id5StringEncoded);\n        return JSON.parse(id5StringDecoded).universal_uid;\n      }else{\n        return;\n      }\n    }catch(e){return;}\n  }\n\n  var getValidId5ID = function(){\n    var universal_uid = check_localStorage(\'id5id\');\n    if(universal_uid){\n      var expHours = 1000 * 60 * 60 * 2;\n      var id5id_last = \'\';\n      var id5idExpTime;\n\n      try{\n        id5id_last = window.localStorage.getItem(\'id5id_last\');\n        id5idExpTime = new Date(id5id_last).getTime() + expHours;\n        }catch(e){};\n\n      if(id5idExpTime && new Date() < new Date(id5idExpTime)){\n        return universal_uid;\n      }else{\n        return \'\';\n      }\n    }else{\n      return \'\';\n    }\n  }\n\n  var id5IdLs = getValidId5ID();\n  if(id5IdLs){\n    setDCAM(id5IdLs);\n    ID5.init({partnerId: 1455});\n  }else{\n    try{\n      ID5.init({partnerId: 1455}).onAvailable(function(status) {\n        var id5IdApi = status.getUserId();\n        setDCAM(id5IdApi);\n      });\n    }catch(e){setDCAM(\'\');}\n  }\n})();\n<\/script>',weight:1}]}],triggerEnabled:null},{id:"48f965f5-7a00-4b1d-9f2f-a82cbb444d4c",title:"SP_上部アンカー広告",condition:{url:{patterns:[{type:"string",value:"articles/1027207"}]},device:{kind:"sp"}},weightedParents:[{id:"1755c932-e8a6-4cd8-a391-86eb34a39c05",title:"BIDSTRAPあり/なしABテスト",components:[{id:"1646faf7-41a2-4907-8eac-ecd97bd4afd6",title:"BIDSTRAPあり",tagText:"<script async src=\"https://fam.adingo.jp/bid-strap/trill/pb.js\"><\/script>\n<script>\n    var bsttag = window.bsttag || { cmd: [] };\n    bsttag.failSafeTimeout = 3000;\n    bsttag.launchAuction = function (slots) {\n        var hbm = {};\n        bsttag.cmd.push(function (cmd) {\n            hbm = cmd.requestBids({ adUnits: slots });\n        });\n\n        setTimeout(function () {\n            if (hbm.isRequestSent) {\n                return;\n            }\n            hbm.isRequestSent = true;\n            googletag.cmd.push(function () {\n                googletag.pubads().refresh(slots);\n            });\n        }, bsttag.failSafeTimeout);\n    };\n<\/script>\n<script>\n    function showHeaderAnchorAd() {\n        googletag.cmd.push(function () {\n            const headerAnchorGamTagId = 'div-gpt-ad-1740044736522-0';\n            const headerAnchorElement = document.querySelector('.js-header-anker');\n            if (!headerAnchorGamTagId || !headerAnchorElement) {\n                return;\n            }\n            const slot = googletag.defineSlot('/21763395206/sp_all/SP_header_anchor_2', [[1, 1], [2, 1], [320, 50]], headerAnchorGamTagId,).addService(googletag.pubads());\n            const slotElement = document.createElement('div');\n\n            slotElement.id = headerAnchorGamTagId;\n            headerAnchorElement.appendChild(slotElement);\n            bsttag.launchAuction([slot]);\n        });\n    }\n<\/script>",weight:1},{id:"3f6df0fa-0352-4f34-ab1a-7ed50250433c",title:"BIDSTRAPなし",tagText:"<script>\n    function showHeaderAnchorAd() {\n        googletag.cmd.push(function () {\n            const headerAnchorGamTagId = 'div-gpt-ad-1676254477673-0';\n            const headerAnchorElement = document.querySelector('.js-header-anker');\n            if (!headerAnchorGamTagId || !headerAnchorElement) {\n                return;\n            }\n            const slot = googletag.defineSlot('/21763395206/sp_all/SP_header_anchor', [[1, 1], [2, 1], [320, 50]], headerAnchorGamTagId,).addService(googletag.pubads());\n            const slotElement = document.createElement('div');\n\n            slotElement.id = headerAnchorGamTagId;\n            headerAnchorElement.appendChild(slotElement);\n            googletag.pubads().refresh([slot]);\n        });\n    }\n<\/script>",weight:1}]}],triggerEnabled:!0},{id:"663e914a-061c-432a-b2d4-882eb644bb58",title:"【テスト環境とarticles/1027207でのみ稼働中】SPテスト用トリガー",condition:{url:{patterns:[{type:"string",value:"trilltrill-dev.jp"},{type:"string",value:"articles/1027207"}]},device:{kind:"sp"}},weightedParents:[{id:"a584ea07-c904-47cc-9e00-4c7f91551afc",title:"SPオーバーレイのリロード処理",components:[{id:"d4cc839a-ea80-4ada-acc1-e8cd92812612",title:"上部アンカーA/Bテスト対応",tagText:"\x3c!-- BL: https://vg-ceg.backlog.com/view/FLUCT_PAM-3818 --\x3e\n<script>\n    window.googletag = window.googletag || { cmd: [] };\n    let fluct_current_refresh_num = 0;\n  \n    googletag.cmd.push(function () {\n      // 更新頻度の設定。秒で指定する\n      // const RELOAD_INTERVAL_SEC = 0.84 * 60;\n      const RELOAD_INTERVAL_SEC = 60; //デバッグ用\n\n      // 更新を実行する回数\n      const MAX_REFRESH_NUM = 3; //デバッグ用、本来は3\n  \n      const FirstLookLineItemIds = [\n        5643631150, 6329292705\n      ];\n  \n      const relaidoPrebidLineItemIds = [\n        5693952390, 5693952396, 5693952399, 5693953377, 5693953383, 5693958942, 5693958945, 5693958948, 5693958951, 5693958954,\n        5693958957, 5693959080, 5693959083, 5693959086, 5693959089, 5693959092, 5693959095, 5693959098, 5693959101, 5693959104,\n        5693959107, 5693959110, 5693959113, 5693959116, 5693959119, 5693959122, 5693959125, 5693959131, 5693959134, 5693959137,\n        5693959143, 5693959149, 5693959152, 5693959155, 5693959158, 5693959164, 5693959167, 5693959170, 5693959173, 5693959176,\n        5693959179, 5693959182, 5693959188, 5693959197, 5693959323, 5693959326, 5693959332, 5693959335, 5693959347, 5693959398,\n        5693959401, 5693959404, 5693959407, 5693959410, 5693959413, 5693959416, 5693959419, 5693959422, 5693959431, 5693959437,\n        5693959560, 5693959563, 5693959566, 5693959569, 5693959572, 5693959575, 5693959578, 5693959581, 5693959590, 5693959602,\n        5693959605, 5693959614, 5693959617, 5693959626, 5693959629, 5693959632, 5693959635, 5693959638, 5693959641, 5693959644,\n        5693959647, 5693959650, 5693959653, 5693959656, 5693959659, 5693959662, 5693959671, 5693959674, 5693959677, 5693959800,\n        5693959818, 5693959821, 5693959824, 5693959830, 5693959833, 5693959836, 5693959839, 5693959842, 5693959845, 5693959854,\n        5693959857, 5693959860, 5693959863, 5693959872, 5693959875, 5693959878, 5694974632, 5694974635, 5694974638, 5694982036,\n        5694982039, 5694982042, 5694982045, 5694982048, 5694982051, 5694982054, 5694982057, 5694982060, 5694982063, 5694982066,\n        5694982069, 5694982072, 5694982075, 5694982078, 5694982201, 5694982204, 5694982207, 5694982210, 5694982216, 5694982219,\n        5694982225, 5694982252, 5694982255, 5694982258, 5694982261, 5694982264, 5694982267, 5694982270, 5694982273, 5694982276,\n        5694982279, 5694982282, 5694982285, 5694982288, 5694982291, 5694982294, 5694982297, 5694982300, 5694982303, 5694982306,\n        5694982309, 5694982312, 5694982315, 5694983248, 5694983251, 5694983254, 5694983257, 5694983260, 5694983263, 5694983266,\n        5694983269, 5694983272, 5694983275, 5694983278, 5694983401, 5694983404, 5694983407, 5694983410, 5694983413, 5694983416,\n        5694983419, 5694983422, 5694983425, 5694983428, 5694983431, 5694983434, 5694983437, 5694983440, 5694983443, 5694983446,\n        5694983449, 5694983452, 5694983455, 5694983458, 5694983461, 5694983464, 5694983467, 5694983470, 5694983473, 5694983476,\n        5694983479, 5694983482, 5694983485, 5694983488, 5694983491, 5694983494, 5694983497, 5694983500, 5694983503, 5694983506,\n        5694983950, 5694983959, 5694983962, 5694983965, 5694983968, 5694983971, 5694983974, 5694983977, 5694983980, 5694983983,\n        5694983986, 5694983989, 5694983992, 5694983995, 5694983998, 5694984121, 5694984124, 5694984127, 5694984130, 5694984133,\n        5694984136, 5694984139, 5694984142, 5694984145, 5694984148, 5694984151, 5694984154, 5694984157, 5694984160, 5694984163,\n        5694984166, 5694984169, 5694984172, 5694984175, 5694984178, 5694984181, 5694984184, 5694984187, 5694984190, 5694984193,\n        5694984196, 5694984199, 5694984202, 5694984205, 5694984208, 5694984211, 5694984214, 5694984217, 5694984220, 5694984223,\n        5694984226, 5694984229, 5694984232, 5694984238, 5694984361, 5694984364, 5694984367, 5694984370, 5694984373, 5694984376,\n        5694984379, 5694984382, 5694984385, 5694984388, 5694984391, 5694984394, 5694984397, 5694984400, 5694984403, 5694984406,\n        5694984409, 5694984412, 5694984415, 5694984418, 5694984421, 5694984424, 5694984427, 5694984430, 5694984433, 5694984436,\n        5694984439, 5694984442, 5694984445, 5694984448, 5694984451, 5694984454, 5694984457, 5694984460, 5694984463, 5694984466,\n        5694984469, 5694984472, 5694984475, 5694984478, 5694984601, 5694984604, 5694984607, 5694984610, 5695551587, 5695551590,\n        5695551593, 5695551596, 5695551599, 5695551722, 5695551728, 5695551731, 5695551734, 5695551737, 5695551740, 5695551743,\n        5695551746, 5695551749, 5695551752, 5695551755, 5695551758, 5695551761, 5695551764, 5695551770, 5695551773, 5695551776,\n        5695551779, 5695551782, 5695551785, 5695551788, 5695551791, 5695551797, 5695551800, 5695551803, 5695551806, 5693952393,\n        5693953380, 5693959128, 5693959140, 5693959146, 5693959161, 5693959185, 5693959191, 5693959194, 5693959320, 5693959329,\n        5693959338, 5693959344, 5693959350, 5693959353, 5693959356, 5693959359, 5693959362, 5693959365, 5693959368, 5693959371,\n        5693959374, 5693959377, 5693959380, 5693959383, 5693959386, 5693959389, 5693959392, 5693959395, 5693959425, 5693959428,\n        5693959434, 5693959584, 5693959587, 5693959593, 5693959596, 5693959599, 5693959608, 5693959611, 5693959620, 5693959623,\n        5693959665, 5693959668, 5693959803, 5693959806, 5693959809, 5693959812, 5693959815, 5693959827, 5693959848, 5693959851,\n        5693959866, 5693959869, 5693959881, 5693959884, 5693959887, 5693959890, 5693959893, 5693959896, 5693959899, 5693959902,\n        5693959905, 5693959908, 5693959911, 5693959914, 5693959917, 5693960040, 5693960043, 5693960046, 5693960049, 5693960052,\n        5693960055, 5693960058, 5694982213, 5694982222, 5694982228, 5694982231, 5694982234, 5694982237, 5694982240, 5694982243,\n        5694982246, 5694982249, 5694983908, 5694983911, 5694983914, 5694983917, 5694983920, 5694983923, 5694983926, 5694983929,\n        5694983932, 5694983935, 5694983938, 5694983941, 5694983944, 5694983947, 5694983953, 5694983956, 5695551725, 5695551767,\n        5695551794\n      ]\n  \n      // 以下の広告申込情報ID及びクリエイティブIDが引きあたったときはリロードを行わない\n      const deniedLineItemIds = [...FirstLookLineItemIds, ...relaidoPrebidLineItemIds]\n  \n      const deniedCreativeIds = [\n        138365235629,\n      ];\n  \n      const underOverlayUnitPath = '/21763395206/overlay/SP_overlay';\n      const underOverlayC1UnitPath = '/21763395206/overlay/SP_overlay_c1';\n      const headOverlayUnitPath = ['/21763395206/sp_all/SP_header_anchor', '/21763395206/sp_all/SP_header_anchor_2'];\n      const headOverlayDivId = 'div-gpt-ad-1676254477673-0';\n  \n      // slotRenderEndedを使い、下部オーバーレイが表示されるたびに再読み込みの登録を行う\n      console.log('SP_overlayのリフレッシュ用のイベントリスナを設定します');\n      googletag.pubads().addEventListener('slotRenderEnded', function (e) {\n  \n        const underOverlaySlot = e.slot;\n        // console.log('Slot render ended: ', e.slot.getAdUnitPath());\n        // console.log('Slot render ended, creativeId: ', e.creativeId);\n  \n        if (\n            underOverlaySlot.getAdUnitPath() !== underOverlayUnitPath\n            && underOverlaySlot.getAdUnitPath() !== underOverlayC1UnitPath\n        ) {\n          // console.log('underOverlaySlot.getAdUnitPath(): ', underOverlaySlot.getAdUnitPath());\n          console.log('D');\n          return;\n        }\n        console.log(`[FLUCT] getAdUnitPath: ${underOverlaySlot.getAdUnitPath()}, lineItemId: ${e.lineItemId}, creativeid: ${e.creativeId}`);\n        console.log(`isEmpty?: ${e.isEmpty}`);\n  \n        // 更新できる最大数までリロードしたら、それ以上はリロードしない\n        fluct_current_refresh_num++;\n        console.log('fluct_current_refresh_num: ', fluct_current_refresh_num); // デバッグ用  \n        \n        if (fluct_current_refresh_num > MAX_REFRESH_NUM){\n          console.log('Reached Max refresh num. will not be refreshed.'); // デバッグ用  \n          console.log('A');\n          return;\n        } \n  \n        if (deniedLineItemIds.includes(e.lineItemId)){\n          console.log('B');\n          return;\n        } \n        if (deniedCreativeIds.includes(e.creativeId)){\n          console.log('C');\n          return;\n        } \n  \n        console.log(`[FLUCT] under overlay shown. setUp setTimeout for RELOAD ad.`);\n  \n        setTimeout(function () {\n          console.log('[FLUCT] reload fired!');\n          // 上部オーバーレイが表示されていたらdestroyする。領域も隠す\n          const headOverlaySlot = googletag.pubads().getSlots().find((s) => headOverlayUnitPath.includes(s.getAdUnitPath()));\n          if (headOverlaySlot) {\n            console.log('headerOverlay slot is :', headOverlaySlot.getAdUnitPath());\n            const globalHeader = document.querySelector('.js-global-header');\n            const headerAnchor = document.querySelector('.js-header-anker');\n            if (headerAnchor && globalHeader) {\n              globalHeader.classList.remove('header-GlobalHeader-anker');\n              headerAnchor.classList.remove('header-AnkerAd-visible');\n            }\n            console.log('before destroy slots: ', [headOverlaySlot]);\n            googletag.destroySlots([headOverlaySlot]);\n            console.log('after destroy slots: ', [headOverlaySlot]);\n            const headOverlayDiv = document.getElementById(headOverlayDivId);\n            if (headOverlayDiv) {\n              headOverlayDiv.remove();\n            }\n          }\n  \n          // imobileのクリエイティブはGAMのdivの直前に専用のdivを突っ込むため、refreshしてもアドが残り続けてしまう\n          // idがわかりやすいので、リロード前にDOMの存在を確認して削除する\n          const imOldAdDiv = document.getElementById('im_ov');\n          if (imOldAdDiv) {\n            imOldAdDiv.remove();\n          }\n  \n          // リロード時に全枠にKVをつける。上部オーバーレイにもリロード時につけたいので、setTimeoutの中でやる\n          googletag.pubads().setTargeting('refresh', 'refresh');\n  \n          // 下部オーバーレイをリロード。上部オーバーレイは既存の仕組みで表示が行われる\n          pbjs.requestBids({\n            bidsBackHandler: function () {\n              pbjs.setTargetingForGPTAsync([underOverlaySlot]);\n              googletag.pubads().refresh([underOverlaySlot]);\n            }\n          });\n        }, RELOAD_INTERVAL_SEC * 1000);\n      });\n    });\n  <\/script>\n  ",weight:1}]}],triggerEnabled:!0},{id:"fe553a46-3ad2-4bd0-8929-3b7b2c68b235",title:"オーバーレイのリロード処理",condition:{excludeUrl:{patterns:[{type:"string",value:"trilltrill-dev.jp"},{type:"string",value:"articles/1027207"}]},device:{kind:"sp"}},weightedParents:[{id:"8bc36b4a-a044-494c-8086-191c73a53e13",title:"オーバーレイのリロード処理",components:[{id:"a3387fea-64c4-4c6b-ac85-2e893e0023fe",title:"【検証中】上部アンカーA/Bテスト対応",tagText:"\x3c!-- BL: https://vg-ceg.backlog.com/view/FLUCT_PAM-3818 --\x3e\n<script>\n  window.googletag = window.googletag || { cmd: [] };\n  let fluct_current_refresh_num = 0;\n\n  googletag.cmd.push(function () {\n    // 更新頻度の設定。秒で指定する\n    const RELOAD_INTERVAL_SEC = 0.84 * 60;\n    // 更新を実行する回数\n    const MAX_REFRESH_NUM = 3;\n\n    const FirstLookLineItemIds = [\n      5643631150, 6329292705\n    ];\n\n    const relaidoPrebidLineItemIds = [\n      5693952390, 5693952396, 5693952399, 5693953377, 5693953383, 5693958942, 5693958945, 5693958948, 5693958951, 5693958954,\n      5693958957, 5693959080, 5693959083, 5693959086, 5693959089, 5693959092, 5693959095, 5693959098, 5693959101, 5693959104,\n      5693959107, 5693959110, 5693959113, 5693959116, 5693959119, 5693959122, 5693959125, 5693959131, 5693959134, 5693959137,\n      5693959143, 5693959149, 5693959152, 5693959155, 5693959158, 5693959164, 5693959167, 5693959170, 5693959173, 5693959176,\n      5693959179, 5693959182, 5693959188, 5693959197, 5693959323, 5693959326, 5693959332, 5693959335, 5693959347, 5693959398,\n      5693959401, 5693959404, 5693959407, 5693959410, 5693959413, 5693959416, 5693959419, 5693959422, 5693959431, 5693959437,\n      5693959560, 5693959563, 5693959566, 5693959569, 5693959572, 5693959575, 5693959578, 5693959581, 5693959590, 5693959602,\n      5693959605, 5693959614, 5693959617, 5693959626, 5693959629, 5693959632, 5693959635, 5693959638, 5693959641, 5693959644,\n      5693959647, 5693959650, 5693959653, 5693959656, 5693959659, 5693959662, 5693959671, 5693959674, 5693959677, 5693959800,\n      5693959818, 5693959821, 5693959824, 5693959830, 5693959833, 5693959836, 5693959839, 5693959842, 5693959845, 5693959854,\n      5693959857, 5693959860, 5693959863, 5693959872, 5693959875, 5693959878, 5694974632, 5694974635, 5694974638, 5694982036,\n      5694982039, 5694982042, 5694982045, 5694982048, 5694982051, 5694982054, 5694982057, 5694982060, 5694982063, 5694982066,\n      5694982069, 5694982072, 5694982075, 5694982078, 5694982201, 5694982204, 5694982207, 5694982210, 5694982216, 5694982219,\n      5694982225, 5694982252, 5694982255, 5694982258, 5694982261, 5694982264, 5694982267, 5694982270, 5694982273, 5694982276,\n      5694982279, 5694982282, 5694982285, 5694982288, 5694982291, 5694982294, 5694982297, 5694982300, 5694982303, 5694982306,\n      5694982309, 5694982312, 5694982315, 5694983248, 5694983251, 5694983254, 5694983257, 5694983260, 5694983263, 5694983266,\n      5694983269, 5694983272, 5694983275, 5694983278, 5694983401, 5694983404, 5694983407, 5694983410, 5694983413, 5694983416,\n      5694983419, 5694983422, 5694983425, 5694983428, 5694983431, 5694983434, 5694983437, 5694983440, 5694983443, 5694983446,\n      5694983449, 5694983452, 5694983455, 5694983458, 5694983461, 5694983464, 5694983467, 5694983470, 5694983473, 5694983476,\n      5694983479, 5694983482, 5694983485, 5694983488, 5694983491, 5694983494, 5694983497, 5694983500, 5694983503, 5694983506,\n      5694983950, 5694983959, 5694983962, 5694983965, 5694983968, 5694983971, 5694983974, 5694983977, 5694983980, 5694983983,\n      5694983986, 5694983989, 5694983992, 5694983995, 5694983998, 5694984121, 5694984124, 5694984127, 5694984130, 5694984133,\n      5694984136, 5694984139, 5694984142, 5694984145, 5694984148, 5694984151, 5694984154, 5694984157, 5694984160, 5694984163,\n      5694984166, 5694984169, 5694984172, 5694984175, 5694984178, 5694984181, 5694984184, 5694984187, 5694984190, 5694984193,\n      5694984196, 5694984199, 5694984202, 5694984205, 5694984208, 5694984211, 5694984214, 5694984217, 5694984220, 5694984223,\n      5694984226, 5694984229, 5694984232, 5694984238, 5694984361, 5694984364, 5694984367, 5694984370, 5694984373, 5694984376,\n      5694984379, 5694984382, 5694984385, 5694984388, 5694984391, 5694984394, 5694984397, 5694984400, 5694984403, 5694984406,\n      5694984409, 5694984412, 5694984415, 5694984418, 5694984421, 5694984424, 5694984427, 5694984430, 5694984433, 5694984436,\n      5694984439, 5694984442, 5694984445, 5694984448, 5694984451, 5694984454, 5694984457, 5694984460, 5694984463, 5694984466,\n      5694984469, 5694984472, 5694984475, 5694984478, 5694984601, 5694984604, 5694984607, 5694984610, 5695551587, 5695551590,\n      5695551593, 5695551596, 5695551599, 5695551722, 5695551728, 5695551731, 5695551734, 5695551737, 5695551740, 5695551743,\n      5695551746, 5695551749, 5695551752, 5695551755, 5695551758, 5695551761, 5695551764, 5695551770, 5695551773, 5695551776,\n      5695551779, 5695551782, 5695551785, 5695551788, 5695551791, 5695551797, 5695551800, 5695551803, 5695551806, 5693952393,\n      5693953380, 5693959128, 5693959140, 5693959146, 5693959161, 5693959185, 5693959191, 5693959194, 5693959320, 5693959329,\n      5693959338, 5693959344, 5693959350, 5693959353, 5693959356, 5693959359, 5693959362, 5693959365, 5693959368, 5693959371,\n      5693959374, 5693959377, 5693959380, 5693959383, 5693959386, 5693959389, 5693959392, 5693959395, 5693959425, 5693959428,\n      5693959434, 5693959584, 5693959587, 5693959593, 5693959596, 5693959599, 5693959608, 5693959611, 5693959620, 5693959623,\n      5693959665, 5693959668, 5693959803, 5693959806, 5693959809, 5693959812, 5693959815, 5693959827, 5693959848, 5693959851,\n      5693959866, 5693959869, 5693959881, 5693959884, 5693959887, 5693959890, 5693959893, 5693959896, 5693959899, 5693959902,\n      5693959905, 5693959908, 5693959911, 5693959914, 5693959917, 5693960040, 5693960043, 5693960046, 5693960049, 5693960052,\n      5693960055, 5693960058, 5694982213, 5694982222, 5694982228, 5694982231, 5694982234, 5694982237, 5694982240, 5694982243,\n      5694982246, 5694982249, 5694983908, 5694983911, 5694983914, 5694983917, 5694983920, 5694983923, 5694983926, 5694983929,\n      5694983932, 5694983935, 5694983938, 5694983941, 5694983944, 5694983947, 5694983953, 5694983956, 5695551725, 5695551767,\n      5695551794\n    ]\n\n    // 以下の広告申込情報ID及びクリエイティブIDが引きあたったときはリロードを行わない\n    const deniedLineItemIds = [...FirstLookLineItemIds, ...relaidoPrebidLineItemIds]\n\n    const deniedCreativeIds = [\n      138365235629,\n    ];\n\n    const underOverlayUnitPath = '/21763395206/overlay/SP_overlay';\n    const underOverlayC1UnitPath = '/21763395206/overlay/SP_overlay_c1';\n    const underOverlayC2UnitPath = '/21763395206/overlay/SP_overlay_c2';\n    const headOverlayUnitPath = ['/21763395206/sp_all/SP_header_anchor', '/21763395206/sp_all/SP_header_anchor_2'];\n    const headOverlayDivId = 'div-gpt-ad-1676254477673-0';\n\n    // slotRenderEndedを使い、下部オーバーレイが表示されるたびに再読み込みの登録を行う\n    googletag.pubads().addEventListener('slotRenderEnded', function (e) {\n\n      const underOverlaySlot = e.slot;\n\n      if (\n        underOverlaySlot.getAdUnitPath() !== underOverlayUnitPath\n        && underOverlaySlot.getAdUnitPath() !== underOverlayC1UnitPath\n        && underOverlaySlot.getAdUnitPath() !== underOverlayC2UnitPath\n      ) return;\n      console.log(`[FLUCT] getAdUnitPath: ${underOverlaySlot.getAdUnitPath()}, lineItemId: ${e.lineItemId}, creativeid: ${e.creativeId}`);\n\n      // 更新できる最大数までリロードしたら、それ以上はリロードしない\n      fluct_current_refresh_num++;\n      if (fluct_current_refresh_num > MAX_REFRESH_NUM) return;\n\n      if (deniedLineItemIds.includes(e.lineItemId)) return;\n      if (deniedCreativeIds.includes(e.creativeId)) return;\n\n      console.log(`[FLUCT] under overlay shown. setUp setTimeout for RELOAD ad.`);\n\n      setTimeout(function () {\n        console.log('[FLUCT] reload fired!');\n        // 上部オーバーレイが表示されていたらdestroyする。領域も隠す\n        const headOverlaySlot = googletag.pubads().getSlots().find((s) => headOverlayUnitPath.includes(s.getAdUnitPath()));\n        if (headOverlaySlot) {\n          const globalHeader = document.querySelector('.js-global-header');\n          const headerAnchor = document.querySelector('.js-header-anker');\n          if (headerAnchor && globalHeader) {\n            globalHeader.classList.remove('header-GlobalHeader-anker');\n            headerAnchor.classList.remove('header-AnkerAd-visible');\n          }\n          googletag.destroySlots([headOverlaySlot]);\n          const headOverlayDiv = document.getElementById(headOverlayDivId);\n          if (headOverlayDiv) {\n            headOverlayDiv.remove();\n          }\n        }\n\n        // imobileのクリエイティブはGAMのdivの直前に専用のdivを突っ込むため、refreshしてもアドが残り続けてしまう\n        // idがわかりやすいので、リロード前にDOMの存在を確認して削除する\n        const imOldAdDiv = document.getElementById('im_ov');\n        if (imOldAdDiv) {\n          imOldAdDiv.remove();\n        }\n\n        // リロード時に全枠にKVをつける。上部オーバーレイにもリロード時につけたいので、setTimeoutの中でやる\n        googletag.pubads().setTargeting('refresh', 'refresh');\n\n        // 下部オーバーレイをリロード。上部オーバーレイは既存の仕組みで表示が行われる\n        pbjs.requestBids({\n          bidsBackHandler: function () {\n            pbjs.setTargetingForGPTAsync([underOverlaySlot]);\n            googletag.pubads().refresh([underOverlaySlot]);\n          }\n        });\n      }, RELOAD_INTERVAL_SEC * 1000);\n    });\n  });\n<\/script>\n",weight:0},{id:"c320c49f-a980-4ee9-9cfd-913b4da07b83",title:"【不使用】オーバーレイのリロード処理（回数制限、KV全枠付与）",tagText:"\x3c!-- BL: https://vg-ceg.backlog.com/view/FLUCT_PAM-3818 --\x3e\n<script>\n  window.googletag = window.googletag || { cmd: [] };\n  let fluct_current_refresh_num = 0;\n\n  googletag.cmd.push(function () {\n    // 更新頻度の設定。秒で指定する\n    const RELOAD_INTERVAL_SEC = 0.84 * 60;\n    // 更新を実行する回数\n    const MAX_REFRESH_NUM = 3;\n\n    const FirstLookLineItemIds = [\n      5643631150, 6329292705\n    ];\n\n    const relaidoPrebidLineItemIds = [\n      5693952390, 5693952396, 5693952399, 5693953377, 5693953383, 5693958942, 5693958945, 5693958948, 5693958951, 5693958954,\n      5693958957, 5693959080, 5693959083, 5693959086, 5693959089, 5693959092, 5693959095, 5693959098, 5693959101, 5693959104,\n      5693959107, 5693959110, 5693959113, 5693959116, 5693959119, 5693959122, 5693959125, 5693959131, 5693959134, 5693959137,\n      5693959143, 5693959149, 5693959152, 5693959155, 5693959158, 5693959164, 5693959167, 5693959170, 5693959173, 5693959176,\n      5693959179, 5693959182, 5693959188, 5693959197, 5693959323, 5693959326, 5693959332, 5693959335, 5693959347, 5693959398,\n      5693959401, 5693959404, 5693959407, 5693959410, 5693959413, 5693959416, 5693959419, 5693959422, 5693959431, 5693959437,\n      5693959560, 5693959563, 5693959566, 5693959569, 5693959572, 5693959575, 5693959578, 5693959581, 5693959590, 5693959602,\n      5693959605, 5693959614, 5693959617, 5693959626, 5693959629, 5693959632, 5693959635, 5693959638, 5693959641, 5693959644,\n      5693959647, 5693959650, 5693959653, 5693959656, 5693959659, 5693959662, 5693959671, 5693959674, 5693959677, 5693959800,\n      5693959818, 5693959821, 5693959824, 5693959830, 5693959833, 5693959836, 5693959839, 5693959842, 5693959845, 5693959854,\n      5693959857, 5693959860, 5693959863, 5693959872, 5693959875, 5693959878, 5694974632, 5694974635, 5694974638, 5694982036,\n      5694982039, 5694982042, 5694982045, 5694982048, 5694982051, 5694982054, 5694982057, 5694982060, 5694982063, 5694982066,\n      5694982069, 5694982072, 5694982075, 5694982078, 5694982201, 5694982204, 5694982207, 5694982210, 5694982216, 5694982219,\n      5694982225, 5694982252, 5694982255, 5694982258, 5694982261, 5694982264, 5694982267, 5694982270, 5694982273, 5694982276,\n      5694982279, 5694982282, 5694982285, 5694982288, 5694982291, 5694982294, 5694982297, 5694982300, 5694982303, 5694982306,\n      5694982309, 5694982312, 5694982315, 5694983248, 5694983251, 5694983254, 5694983257, 5694983260, 5694983263, 5694983266,\n      5694983269, 5694983272, 5694983275, 5694983278, 5694983401, 5694983404, 5694983407, 5694983410, 5694983413, 5694983416,\n      5694983419, 5694983422, 5694983425, 5694983428, 5694983431, 5694983434, 5694983437, 5694983440, 5694983443, 5694983446,\n      5694983449, 5694983452, 5694983455, 5694983458, 5694983461, 5694983464, 5694983467, 5694983470, 5694983473, 5694983476,\n      5694983479, 5694983482, 5694983485, 5694983488, 5694983491, 5694983494, 5694983497, 5694983500, 5694983503, 5694983506,\n      5694983950, 5694983959, 5694983962, 5694983965, 5694983968, 5694983971, 5694983974, 5694983977, 5694983980, 5694983983,\n      5694983986, 5694983989, 5694983992, 5694983995, 5694983998, 5694984121, 5694984124, 5694984127, 5694984130, 5694984133,\n      5694984136, 5694984139, 5694984142, 5694984145, 5694984148, 5694984151, 5694984154, 5694984157, 5694984160, 5694984163,\n      5694984166, 5694984169, 5694984172, 5694984175, 5694984178, 5694984181, 5694984184, 5694984187, 5694984190, 5694984193,\n      5694984196, 5694984199, 5694984202, 5694984205, 5694984208, 5694984211, 5694984214, 5694984217, 5694984220, 5694984223,\n      5694984226, 5694984229, 5694984232, 5694984238, 5694984361, 5694984364, 5694984367, 5694984370, 5694984373, 5694984376,\n      5694984379, 5694984382, 5694984385, 5694984388, 5694984391, 5694984394, 5694984397, 5694984400, 5694984403, 5694984406,\n      5694984409, 5694984412, 5694984415, 5694984418, 5694984421, 5694984424, 5694984427, 5694984430, 5694984433, 5694984436,\n      5694984439, 5694984442, 5694984445, 5694984448, 5694984451, 5694984454, 5694984457, 5694984460, 5694984463, 5694984466,\n      5694984469, 5694984472, 5694984475, 5694984478, 5694984601, 5694984604, 5694984607, 5694984610, 5695551587, 5695551590,\n      5695551593, 5695551596, 5695551599, 5695551722, 5695551728, 5695551731, 5695551734, 5695551737, 5695551740, 5695551743,\n      5695551746, 5695551749, 5695551752, 5695551755, 5695551758, 5695551761, 5695551764, 5695551770, 5695551773, 5695551776,\n      5695551779, 5695551782, 5695551785, 5695551788, 5695551791, 5695551797, 5695551800, 5695551803, 5695551806, 5693952393,\n      5693953380, 5693959128, 5693959140, 5693959146, 5693959161, 5693959185, 5693959191, 5693959194, 5693959320, 5693959329,\n      5693959338, 5693959344, 5693959350, 5693959353, 5693959356, 5693959359, 5693959362, 5693959365, 5693959368, 5693959371,\n      5693959374, 5693959377, 5693959380, 5693959383, 5693959386, 5693959389, 5693959392, 5693959395, 5693959425, 5693959428,\n      5693959434, 5693959584, 5693959587, 5693959593, 5693959596, 5693959599, 5693959608, 5693959611, 5693959620, 5693959623,\n      5693959665, 5693959668, 5693959803, 5693959806, 5693959809, 5693959812, 5693959815, 5693959827, 5693959848, 5693959851,\n      5693959866, 5693959869, 5693959881, 5693959884, 5693959887, 5693959890, 5693959893, 5693959896, 5693959899, 5693959902,\n      5693959905, 5693959908, 5693959911, 5693959914, 5693959917, 5693960040, 5693960043, 5693960046, 5693960049, 5693960052,\n      5693960055, 5693960058, 5694982213, 5694982222, 5694982228, 5694982231, 5694982234, 5694982237, 5694982240, 5694982243,\n      5694982246, 5694982249, 5694983908, 5694983911, 5694983914, 5694983917, 5694983920, 5694983923, 5694983926, 5694983929,\n      5694983932, 5694983935, 5694983938, 5694983941, 5694983944, 5694983947, 5694983953, 5694983956, 5695551725, 5695551767,\n      5695551794\n    ]\n\n    // 以下の広告申込情報ID及びクリエイティブIDが引きあたったときはリロードを行わない\n    const deniedLineItemIds = [...FirstLookLineItemIds, ...relaidoPrebidLineItemIds]\n\n    const deniedCreativeIds = [\n      138365235629,\n    ];\n\n    const underOverlayUnitPath = '/21763395206/overlay/SP_overlay';\n    const headOverlayUnitPath = '/21763395206/sp_all/SP_header_anchor';\n    const headOverlayDivId = 'div-gpt-ad-1676254477673-0';\n\n    // slotRenderEndedを使い、下部オーバーレイが表示されるたびに再読み込みの登録を行う\n    googletag.pubads().addEventListener('slotRenderEnded', function (e) {\n\n      const underOverlaySlot = e.slot;\n\n      if (underOverlaySlot.getAdUnitPath() !== underOverlayUnitPath) return;\n      console.log(`[FLUCT] getAdUnitPath: ${underOverlaySlot.getAdUnitPath()}, lineItemId: ${e.lineItemId}, creativeid: ${e.creativeId}`);\n\n      // 更新できる最大数までリロードしたら、それ以上はリロードしない\n      fluct_current_refresh_num++;\n      if (fluct_current_refresh_num > MAX_REFRESH_NUM) return;\n\n      if (deniedLineItemIds.includes(e.lineItemId)) return;\n      if (deniedCreativeIds.includes(e.creativeId)) return;\n\n      console.log(`[FLUCT] under overlay shown. setUp setTimeout for RELOAD ad.`);\n\n      setTimeout(function () {\n        console.log('[FLUCT] reload fired!');\n        // 上部オーバーレイが表示されていたらdestroyする。領域も隠す\n        const headOverlaySlot = googletag.pubads().getSlots().find((s) => s.getAdUnitPath() === headOverlayUnitPath);\n        if (headOverlaySlot) {\n          const globalHeader = document.querySelector('.js-global-header');\n          const headerAnchor = document.querySelector('.js-header-anker');\n          if (headerAnchor && globalHeader) {\n            globalHeader.classList.remove('header-GlobalHeader-anker');\n            headerAnchor.classList.remove('header-AnkerAd-visible');\n          }\n          googletag.destroySlots([headOverlaySlot]);\n          const headOverlayDiv = document.getElementById(headOverlayDivId);\n          if (headOverlayDiv) {\n            headOverlayDiv.remove();\n          }\n        }\n\n        // imobileのクリエイティブはGAMのdivの直前に専用のdivを突っ込むため、refreshしてもアドが残り続けてしまう\n        // idがわかりやすいので、リロード前にDOMの存在を確認して削除する\n        const imOldAdDiv = document.getElementById('im_ov');\n        if (imOldAdDiv) {\n          imOldAdDiv.remove();\n        }\n\n        // リロード時に全枠にKVをつける。上部オーバーレイにもリロード時につけたいので、setTimeoutの中でやる\n        googletag.pubads().setTargeting('refresh', 'refresh');\n\n        // 下部オーバーレイをリロード。上部オーバーレイは既存の仕組みで表示が行われる\n        pbjs.requestBids({\n          bidsBackHandler: function () {\n            pbjs.setTargetingForGPTAsync([underOverlaySlot]);\n            googletag.pubads().refresh([underOverlaySlot]);\n          }\n        });\n      }, RELOAD_INTERVAL_SEC * 1000);\n    });\n  });\n<\/script>\n",weight:0},{id:"ae4ba727-7424-408e-831b-72651f673a11",title:"【不使用】オーバーレイのリロード処理 2024-04-25(木) 〜",tagText:"<script>\n  window.googletag = window.googletag || { cmd: [] };\n  \n  googletag.cmd.push(function() {\n    // 更新頻度の設定。秒で指定する\n    const RELOAD_INTERVAL_SEC = 0.84 * 60;\n    // 以下の広告申込情報ID及びクリエイティブIDが引きあたったときはリロードを行わない\n    const deniedLineItemIds = [\n      6329292705,\n      5643631150,\n    ];\n    const deniedCreativeIds = [\n      138365235629,\n    ];\n\n    const underOverlayUnitPath = '/21763395206/overlay/SP_overlay';\n    const headOverlayUnitPath = '/21763395206/sp_all/SP_header_anchor';\n    const headOverlayDivId = 'div-gpt-ad-1676254477673-0';\n\n    // slotRenderEndedを使い、下部オーバーレイが表示されるたびに再読み込みの登録を行う\n    googletag.pubads().addEventListener('slotRenderEnded', function(e) {\n      const underOverlaySlot = e.slot;\n      \n      if (underOverlaySlot.getAdUnitPath() !== underOverlayUnitPath) return;\n      console.log(`[FLUCT] getAdUnitPath: ${underOverlaySlot.getAdUnitPath()}, lineItemId: ${e.lineItemId}, creativeid: ${e.creativeId}`);\n      \n      if (deniedLineItemIds.includes(e.lineItemId)) return;\n      if (deniedCreativeIds.includes(e.creativeId)) return;\n      \n      console.log(`[FLUCT] under overlay shown. setUp setTimeout for RELOAD ad.`);\n\n      underOverlaySlot.setTargeting('refresh', 'refresh');\n      \n      setTimeout(function() {\n        console.log('[FLUCT] reload fired!');\n        // 上部オーバーレイが表示されていたらdestroyする。領域も隠す\n        const headOverlaySlot = googletag.pubads().getSlots().find((s) => s.getAdUnitPath() === headOverlayUnitPath);\n        if (headOverlaySlot) {\n          const globalHeader = document.querySelector('.js-global-header');\n          const headerAnchor = document.querySelector('.js-header-anker');\n          if (headerAnchor && globalHeader) {\n            globalHeader.classList.remove('header-GlobalHeader-anker');\n            headerAnchor.classList.remove('header-AnkerAd-visible');\n          }\n          googletag.destroySlots([headOverlaySlot]);\n          const headOverlayDiv = document.getElementById(headOverlayDivId);\n          if (headOverlayDiv) {\n            headOverlayDiv.remove();\n          }\n        }\n        \n        // imobileのクリエイティブはGAMのdivの直前に専用のdivを突っ込むため、refreshしてもアドが残り続けてしまう\n        // idがわかりやすいので、リロード前にDOMの存在を確認して削除する\n        const imOldAdDiv = document.getElementById('im_ov');\n        if (imOldAdDiv) {\n          imOldAdDiv.remove();\n        }\n\n        // 下部オーバーレイをリロード。上部オーバーレイは既存の仕組みで表示が行われる\n        pbjs.requestBids({\n          bidsBackHandler: function() {\n            pbjs.setTargetingForGPTAsync([underOverlaySlot]);\n            googletag.pubads().refresh([underOverlaySlot]);\n          }\n        });\n      }, RELOAD_INTERVAL_SEC * 1000);\n    });\n  });\n<\/script>",weight:0},{id:"c51934e1-bf8b-4282-ae04-06c5fb92d352",title:"【不使用】オーバーレイのリロード処理（下部オーバーレイ出し分け、回数制限、KV全枠付与、c2もリフレッシュ対象枠に追加、SP_overlayではbidderpubmatic時にrefresh停止）：〜2025/05/14",tagText:"\x3c!-- BL: https://vg-ceg.backlog.com/view/FLUCT_PAM-3818 --\x3e\r\n<script>\r\n    window.googletag = window.googletag || { cmd: [] };\r\n    let fluct_current_refresh_num = 0;\r\n  \r\n    googletag.cmd.push(function () {\r\n      // 更新頻度の設定。秒で指定する\r\n      const RELOAD_INTERVAL_SEC = 0.84 * 60;\r\n      // 更新を実行する回数\r\n      const MAX_REFRESH_NUM = 3;\r\n  \r\n      const FirstLookLineItemIds = [\r\n        5643631150, 6329292705\r\n      ];\r\n  \r\n      const relaidoPrebidLineItemIds = [\r\n        5693952390, 5693952396, 5693952399, 5693953377, 5693953383, 5693958942, 5693958945, 5693958948, 5693958951, 5693958954,\r\n        5693958957, 5693959080, 5693959083, 5693959086, 5693959089, 5693959092, 5693959095, 5693959098, 5693959101, 5693959104,\r\n        5693959107, 5693959110, 5693959113, 5693959116, 5693959119, 5693959122, 5693959125, 5693959131, 5693959134, 5693959137,\r\n        5693959143, 5693959149, 5693959152, 5693959155, 5693959158, 5693959164, 5693959167, 5693959170, 5693959173, 5693959176,\r\n        5693959179, 5693959182, 5693959188, 5693959197, 5693959323, 5693959326, 5693959332, 5693959335, 5693959347, 5693959398,\r\n        5693959401, 5693959404, 5693959407, 5693959410, 5693959413, 5693959416, 5693959419, 5693959422, 5693959431, 5693959437,\r\n        5693959560, 5693959563, 5693959566, 5693959569, 5693959572, 5693959575, 5693959578, 5693959581, 5693959590, 5693959602,\r\n        5693959605, 5693959614, 5693959617, 5693959626, 5693959629, 5693959632, 5693959635, 5693959638, 5693959641, 5693959644,\r\n        5693959647, 5693959650, 5693959653, 5693959656, 5693959659, 5693959662, 5693959671, 5693959674, 5693959677, 5693959800,\r\n        5693959818, 5693959821, 5693959824, 5693959830, 5693959833, 5693959836, 5693959839, 5693959842, 5693959845, 5693959854,\r\n        5693959857, 5693959860, 5693959863, 5693959872, 5693959875, 5693959878, 5694974632, 5694974635, 5694974638, 5694982036,\r\n        5694982039, 5694982042, 5694982045, 5694982048, 5694982051, 5694982054, 5694982057, 5694982060, 5694982063, 5694982066,\r\n        5694982069, 5694982072, 5694982075, 5694982078, 5694982201, 5694982204, 5694982207, 5694982210, 5694982216, 5694982219,\r\n        5694982225, 5694982252, 5694982255, 5694982258, 5694982261, 5694982264, 5694982267, 5694982270, 5694982273, 5694982276,\r\n        5694982279, 5694982282, 5694982285, 5694982288, 5694982291, 5694982294, 5694982297, 5694982300, 5694982303, 5694982306,\r\n        5694982309, 5694982312, 5694982315, 5694983248, 5694983251, 5694983254, 5694983257, 5694983260, 5694983263, 5694983266,\r\n        5694983269, 5694983272, 5694983275, 5694983278, 5694983401, 5694983404, 5694983407, 5694983410, 5694983413, 5694983416,\r\n        5694983419, 5694983422, 5694983425, 5694983428, 5694983431, 5694983434, 5694983437, 5694983440, 5694983443, 5694983446,\r\n        5694983449, 5694983452, 5694983455, 5694983458, 5694983461, 5694983464, 5694983467, 5694983470, 5694983473, 5694983476,\r\n        5694983479, 5694983482, 5694983485, 5694983488, 5694983491, 5694983494, 5694983497, 5694983500, 5694983503, 5694983506,\r\n        5694983950, 5694983959, 5694983962, 5694983965, 5694983968, 5694983971, 5694983974, 5694983977, 5694983980, 5694983983,\r\n        5694983986, 5694983989, 5694983992, 5694983995, 5694983998, 5694984121, 5694984124, 5694984127, 5694984130, 5694984133,\r\n        5694984136, 5694984139, 5694984142, 5694984145, 5694984148, 5694984151, 5694984154, 5694984157, 5694984160, 5694984163,\r\n        5694984166, 5694984169, 5694984172, 5694984175, 5694984178, 5694984181, 5694984184, 5694984187, 5694984190, 5694984193,\r\n        5694984196, 5694984199, 5694984202, 5694984205, 5694984208, 5694984211, 5694984214, 5694984217, 5694984220, 5694984223,\r\n        5694984226, 5694984229, 5694984232, 5694984238, 5694984361, 5694984364, 5694984367, 5694984370, 5694984373, 5694984376,\r\n        5694984379, 5694984382, 5694984385, 5694984388, 5694984391, 5694984394, 5694984397, 5694984400, 5694984403, 5694984406,\r\n        5694984409, 5694984412, 5694984415, 5694984418, 5694984421, 5694984424, 5694984427, 5694984430, 5694984433, 5694984436,\r\n        5694984439, 5694984442, 5694984445, 5694984448, 5694984451, 5694984454, 5694984457, 5694984460, 5694984463, 5694984466,\r\n        5694984469, 5694984472, 5694984475, 5694984478, 5694984601, 5694984604, 5694984607, 5694984610, 5695551587, 5695551590,\r\n        5695551593, 5695551596, 5695551599, 5695551722, 5695551728, 5695551731, 5695551734, 5695551737, 5695551740, 5695551743,\r\n        5695551746, 5695551749, 5695551752, 5695551755, 5695551758, 5695551761, 5695551764, 5695551770, 5695551773, 5695551776,\r\n        5695551779, 5695551782, 5695551785, 5695551788, 5695551791, 5695551797, 5695551800, 5695551803, 5695551806, 5693952393,\r\n        5693953380, 5693959128, 5693959140, 5693959146, 5693959161, 5693959185, 5693959191, 5693959194, 5693959320, 5693959329,\r\n        5693959338, 5693959344, 5693959350, 5693959353, 5693959356, 5693959359, 5693959362, 5693959365, 5693959368, 5693959371,\r\n        5693959374, 5693959377, 5693959380, 5693959383, 5693959386, 5693959389, 5693959392, 5693959395, 5693959425, 5693959428,\r\n        5693959434, 5693959584, 5693959587, 5693959593, 5693959596, 5693959599, 5693959608, 5693959611, 5693959620, 5693959623,\r\n        5693959665, 5693959668, 5693959803, 5693959806, 5693959809, 5693959812, 5693959815, 5693959827, 5693959848, 5693959851,\r\n        5693959866, 5693959869, 5693959881, 5693959884, 5693959887, 5693959890, 5693959893, 5693959896, 5693959899, 5693959902,\r\n        5693959905, 5693959908, 5693959911, 5693959914, 5693959917, 5693960040, 5693960043, 5693960046, 5693960049, 5693960052,\r\n        5693960055, 5693960058, 5694982213, 5694982222, 5694982228, 5694982231, 5694982234, 5694982237, 5694982240, 5694982243,\r\n        5694982246, 5694982249, 5694983908, 5694983911, 5694983914, 5694983917, 5694983920, 5694983923, 5694983926, 5694983929,\r\n        5694983932, 5694983935, 5694983938, 5694983941, 5694983944, 5694983947, 5694983953, 5694983956, 5695551725, 5695551767,\r\n        5695551794\r\n      ]\r\n  \r\n      // 以下の広告申込情報ID及びクリエイティブIDが引きあたったときはリロードを行わない\r\n      const deniedLineItemIds = [...FirstLookLineItemIds, ...relaidoPrebidLineItemIds]\r\n  \r\n      const deniedCreativeIds = [\r\n        138365235629, 138380805199,\r\n      ];\r\n  \r\n      const underOverlayUnitPath = '/21763395206/overlay/SP_overlay';\r\n      const underOverlayC1UnitPath = '/21763395206/overlay/SP_overlay_c1';\r\n      const underOverlayC2UnitPath = '/21763395206/overlay/SP_overlay_c2';\r\n      const headOverlayUnitPath = '/21763395206/sp_all/SP_header_anchor';\r\n      const headOverlayDivId = 'div-gpt-ad-1676254477673-0';\r\n      \r\n      const deniedRefreshPrebidBidder = ['pubmatic'];\r\n    　const spPrebidOderId = 2980451758;\r\n\r\n    　let refreshOkPrebidBidder;\r\n    　\r\n    　googletag.pubads().addEventListener('slotRequested', (e) => {\r\n        const slot = e.slot\r\n        // SP_overlayでのみ、refresh不可bidder配信時にrefreshを停止する\r\n        if (slot.getAdUnitPath() !== underOverlayUnitPath) {\r\n          return;\r\n        }\r\n        // slot.getTargeting('fbs_bidder')の戻り値は勝者bidderの名前が1つのみ格納された、または空のArrayとなる\r\n        // 例: ['criteo']\r\n        const winPrebidBidder = slot.getTargeting('fbs_bidder')[0];\r\n        refreshOkPrebidBidder = deniedRefreshPrebidBidder.includes(winPrebidBidder) ? false : true;\r\n      })\r\n  \r\n      // slotRenderEndedを使い、下部オーバーレイが表示されるたびに再読み込みの登録を行う\r\n      googletag.pubads().addEventListener('slotRenderEnded', function (e) {\r\n  \r\n        const underOverlaySlot = e.slot;\r\n  \r\n        if (\r\n            underOverlaySlot.getAdUnitPath() !== underOverlayUnitPath\r\n            && underOverlaySlot.getAdUnitPath() !== underOverlayC1UnitPath\r\n            && underOverlaySlot.getAdUnitPath() !== underOverlayC2UnitPath\r\n        ) return;\r\n        \r\n              // SP_overlayにて、リフレッシュ不可bidderが実際に配信された場合、以降のリフレッシュは行わない\r\n        if (underOverlaySlot.getAdUnitPath() === underOverlayUnitPath && e.campaignId === spPrebidOderId && !refreshOkPrebidBidder) {\r\n          return;\r\n        }\r\n\r\n        console.log(`[FLUCT] getAdUnitPath: ${underOverlaySlot.getAdUnitPath()}, lineItemId: ${e.lineItemId}, creativeid: ${e.creativeId}`);\r\n  \r\n        // 更新できる最大数までリロードしたら、それ以上はリロードしない\r\n        fluct_current_refresh_num++;\r\n        if (fluct_current_refresh_num > MAX_REFRESH_NUM) return;\r\n  \r\n        if (deniedLineItemIds.includes(e.lineItemId)) return;\r\n        if (deniedCreativeIds.includes(e.creativeId)) return;\r\n  \r\n        console.log(`[FLUCT] under overlay shown. setUp setTimeout for RELOAD ad.`);\r\n  \r\n        setTimeout(function () {\r\n          console.log('[FLUCT] reload fired!');\r\n          // 上部オーバーレイが表示されていたらdestroyする。領域も隠す\r\n          const headOverlaySlot = googletag.pubads().getSlots().find((s) => s.getAdUnitPath() === headOverlayUnitPath);\r\n          if (headOverlaySlot) {\r\n            const globalHeader = document.querySelector('.js-global-header');\r\n            const headerAnchor = document.querySelector('.js-header-anker');\r\n            if (headerAnchor && globalHeader) {\r\n              globalHeader.classList.remove('header-GlobalHeader-anker');\r\n              headerAnchor.classList.remove('header-AnkerAd-visible');\r\n            }\r\n            googletag.destroySlots([headOverlaySlot]);\r\n            console.log('destroy: ', headOverlaySlot);\r\n            const headOverlayDiv = document.getElementById(headOverlayDivId);\r\n            if (headOverlayDiv) {\r\n              headOverlayDiv.remove();\r\n            }\r\n          }\r\n  \r\n          // imobileのクリエイティブはGAMのdivの直前に専用のdivを突っ込むため、refreshしてもアドが残り続けてしまう\r\n          // idがわかりやすいので、リロード前にDOMの存在を確認して削除する\r\n          const imOldAdDiv = document.getElementById('im_ov');\r\n          if (imOldAdDiv) {\r\n            imOldAdDiv.remove();\r\n          }\r\n  \r\n          // リロード時に全枠にKVをつける。上部オーバーレイにもリロード時につけたいので、setTimeoutの中でやる\r\n          googletag.pubads().setTargeting('refresh', 'refresh');\r\n  \r\n          // 下部オーバーレイをリロード。上部オーバーレイは既存の仕組みで表示が行われる\r\n          pbjs.requestBids({\r\n            bidsBackHandler: function () {\r\n              pbjs.setTargetingForGPTAsync([underOverlaySlot]);\r\n              googletag.pubads().refresh([underOverlaySlot]);\r\n            }\r\n          });\r\n        }, RELOAD_INTERVAL_SEC * 1000);\r\n      });\r\n    });\r\n  <\/script>\r\n  ",weight:0},{id:"702b6424-454f-49bd-bbd6-7809f1a5b64a",title:"【稼働中】オーバーレイのリロード処理（下部オーバーレイ出し分け、回数制限、KV全枠付与、c2もリフレッシュ対象枠に追加、SP_overlayではbidder pubmaticまたはfluctでCPM¥1,000以上の際にはrefresh停止）：2025/05/14〜",tagText:"\x3c!-- BL: https://vg-ceg.backlog.com/view/FLUCT_PAM-3818 --\x3e\r\n<script>\r\n    window.googletag = window.googletag || { cmd: [] };\r\n    let fluct_current_refresh_num = 0;\r\n  \r\n    googletag.cmd.push(function () {\r\n      // 更新頻度の設定。秒で指定する\r\n      const RELOAD_INTERVAL_SEC = 0.84 * 60;\r\n      // 更新を実行する回数\r\n      const MAX_REFRESH_NUM = 3;\r\n  \r\n      const FirstLookLineItemIds = [\r\n        5643631150, 6329292705\r\n      ];\r\n  \r\n      const relaidoPrebidLineItemIds = [\r\n        5693952390, 5693952396, 5693952399, 5693953377, 5693953383, 5693958942, 5693958945, 5693958948, 5693958951, 5693958954,\r\n        5693958957, 5693959080, 5693959083, 5693959086, 5693959089, 5693959092, 5693959095, 5693959098, 5693959101, 5693959104,\r\n        5693959107, 5693959110, 5693959113, 5693959116, 5693959119, 5693959122, 5693959125, 5693959131, 5693959134, 5693959137,\r\n        5693959143, 5693959149, 5693959152, 5693959155, 5693959158, 5693959164, 5693959167, 5693959170, 5693959173, 5693959176,\r\n        5693959179, 5693959182, 5693959188, 5693959197, 5693959323, 5693959326, 5693959332, 5693959335, 5693959347, 5693959398,\r\n        5693959401, 5693959404, 5693959407, 5693959410, 5693959413, 5693959416, 5693959419, 5693959422, 5693959431, 5693959437,\r\n        5693959560, 5693959563, 5693959566, 5693959569, 5693959572, 5693959575, 5693959578, 5693959581, 5693959590, 5693959602,\r\n        5693959605, 5693959614, 5693959617, 5693959626, 5693959629, 5693959632, 5693959635, 5693959638, 5693959641, 5693959644,\r\n        5693959647, 5693959650, 5693959653, 5693959656, 5693959659, 5693959662, 5693959671, 5693959674, 5693959677, 5693959800,\r\n        5693959818, 5693959821, 5693959824, 5693959830, 5693959833, 5693959836, 5693959839, 5693959842, 5693959845, 5693959854,\r\n        5693959857, 5693959860, 5693959863, 5693959872, 5693959875, 5693959878, 5694974632, 5694974635, 5694974638, 5694982036,\r\n        5694982039, 5694982042, 5694982045, 5694982048, 5694982051, 5694982054, 5694982057, 5694982060, 5694982063, 5694982066,\r\n        5694982069, 5694982072, 5694982075, 5694982078, 5694982201, 5694982204, 5694982207, 5694982210, 5694982216, 5694982219,\r\n        5694982225, 5694982252, 5694982255, 5694982258, 5694982261, 5694982264, 5694982267, 5694982270, 5694982273, 5694982276,\r\n        5694982279, 5694982282, 5694982285, 5694982288, 5694982291, 5694982294, 5694982297, 5694982300, 5694982303, 5694982306,\r\n        5694982309, 5694982312, 5694982315, 5694983248, 5694983251, 5694983254, 5694983257, 5694983260, 5694983263, 5694983266,\r\n        5694983269, 5694983272, 5694983275, 5694983278, 5694983401, 5694983404, 5694983407, 5694983410, 5694983413, 5694983416,\r\n        5694983419, 5694983422, 5694983425, 5694983428, 5694983431, 5694983434, 5694983437, 5694983440, 5694983443, 5694983446,\r\n        5694983449, 5694983452, 5694983455, 5694983458, 5694983461, 5694983464, 5694983467, 5694983470, 5694983473, 5694983476,\r\n        5694983479, 5694983482, 5694983485, 5694983488, 5694983491, 5694983494, 5694983497, 5694983500, 5694983503, 5694983506,\r\n        5694983950, 5694983959, 5694983962, 5694983965, 5694983968, 5694983971, 5694983974, 5694983977, 5694983980, 5694983983,\r\n        5694983986, 5694983989, 5694983992, 5694983995, 5694983998, 5694984121, 5694984124, 5694984127, 5694984130, 5694984133,\r\n        5694984136, 5694984139, 5694984142, 5694984145, 5694984148, 5694984151, 5694984154, 5694984157, 5694984160, 5694984163,\r\n        5694984166, 5694984169, 5694984172, 5694984175, 5694984178, 5694984181, 5694984184, 5694984187, 5694984190, 5694984193,\r\n        5694984196, 5694984199, 5694984202, 5694984205, 5694984208, 5694984211, 5694984214, 5694984217, 5694984220, 5694984223,\r\n        5694984226, 5694984229, 5694984232, 5694984238, 5694984361, 5694984364, 5694984367, 5694984370, 5694984373, 5694984376,\r\n        5694984379, 5694984382, 5694984385, 5694984388, 5694984391, 5694984394, 5694984397, 5694984400, 5694984403, 5694984406,\r\n        5694984409, 5694984412, 5694984415, 5694984418, 5694984421, 5694984424, 5694984427, 5694984430, 5694984433, 5694984436,\r\n        5694984439, 5694984442, 5694984445, 5694984448, 5694984451, 5694984454, 5694984457, 5694984460, 5694984463, 5694984466,\r\n        5694984469, 5694984472, 5694984475, 5694984478, 5694984601, 5694984604, 5694984607, 5694984610, 5695551587, 5695551590,\r\n        5695551593, 5695551596, 5695551599, 5695551722, 5695551728, 5695551731, 5695551734, 5695551737, 5695551740, 5695551743,\r\n        5695551746, 5695551749, 5695551752, 5695551755, 5695551758, 5695551761, 5695551764, 5695551770, 5695551773, 5695551776,\r\n        5695551779, 5695551782, 5695551785, 5695551788, 5695551791, 5695551797, 5695551800, 5695551803, 5695551806, 5693952393,\r\n        5693953380, 5693959128, 5693959140, 5693959146, 5693959161, 5693959185, 5693959191, 5693959194, 5693959320, 5693959329,\r\n        5693959338, 5693959344, 5693959350, 5693959353, 5693959356, 5693959359, 5693959362, 5693959365, 5693959368, 5693959371,\r\n        5693959374, 5693959377, 5693959380, 5693959383, 5693959386, 5693959389, 5693959392, 5693959395, 5693959425, 5693959428,\r\n        5693959434, 5693959584, 5693959587, 5693959593, 5693959596, 5693959599, 5693959608, 5693959611, 5693959620, 5693959623,\r\n        5693959665, 5693959668, 5693959803, 5693959806, 5693959809, 5693959812, 5693959815, 5693959827, 5693959848, 5693959851,\r\n        5693959866, 5693959869, 5693959881, 5693959884, 5693959887, 5693959890, 5693959893, 5693959896, 5693959899, 5693959902,\r\n        5693959905, 5693959908, 5693959911, 5693959914, 5693959917, 5693960040, 5693960043, 5693960046, 5693960049, 5693960052,\r\n        5693960055, 5693960058, 5694982213, 5694982222, 5694982228, 5694982231, 5694982234, 5694982237, 5694982240, 5694982243,\r\n        5694982246, 5694982249, 5694983908, 5694983911, 5694983914, 5694983917, 5694983920, 5694983923, 5694983926, 5694983929,\r\n        5694983932, 5694983935, 5694983938, 5694983941, 5694983944, 5694983947, 5694983953, 5694983956, 5695551725, 5695551767,\r\n        5695551794\r\n      ]\r\n  \r\n      // 以下の広告申込情報ID及びクリエイティブIDが引きあたったときはリロードを行わない\r\n      const deniedLineItemIds = [...FirstLookLineItemIds, ...relaidoPrebidLineItemIds]\r\n  \r\n      const deniedCreativeIds = [\r\n        138365235629, 138380805199,\r\n      ];\r\n  \r\n      const underOverlayUnitPath = '/21763395206/overlay/SP_overlay';\r\n      const underOverlayC1UnitPath = '/21763395206/overlay/SP_overlay_c1';\r\n      const underOverlayC2UnitPath = '/21763395206/overlay/SP_overlay_c2';\r\n      const headOverlayUnitPath = '/21763395206/sp_all/SP_header_anchor';\r\n      const headOverlayDivId = 'div-gpt-ad-1676254477673-0';\r\n      \r\n      // deniedRefreshPrebidPriceのCPM以上の入札で配信された場合、以降のrefreshを停止するbidder => 5/22 pabmaticのみ配列から抜いた\r\n      const deniedRefreshPrebidBidder = ['fluct'];\r\n      const deniedRefreshPrebidPrice = 1000;\r\n      \r\n    　const spPrebidOderId = 2980451758;\r\n\r\n    　let refreshNgPrebidBidder;\r\n    　\r\n    　googletag.pubads().addEventListener('slotRequested', (e) => {\r\n        const slot = e.slot\r\n        // SP_overlayでのみ、refresh不可bidder配信時にrefreshを停止する\r\n        if (slot.getAdUnitPath() !== underOverlayUnitPath) {\r\n          return;\r\n        }\r\n        // slot.getTargeting('fbs_bidder')の戻り値は勝者bidderの名前が1つのみ格納された、または空のArrayとなる\r\n        // 例: ['criteo']\r\n        const winPrebidBidder = slot.getTargeting('fbs_bidder')[0];\r\n        // 'fbs_bidder'と同様、slot.getTargeting('fbs_pb')の戻り値は値が1つ格納された、または空のArrayとなる\r\n        // 例: ['15.00'] \r\n        const winPrebidBidderPrice = parseInt(slot.getTargeting('fbs_pb')[0] || 0);\r\n\r\n        // 特定のbidderが指定のCPM以上の入札をしていた場合、refreshNgPrebidBidderはtrueとなる\r\n        refreshNgPrebidBidder =\r\n          deniedRefreshPrebidBidder.includes(winPrebidBidder) && winPrebidBidderPrice >= deniedRefreshPrebidPrice;\r\n      })\r\n  \r\n      // slotRenderEndedを使い、下部オーバーレイが表示されるたびに再読み込みの登録を行う\r\n      googletag.pubads().addEventListener('slotRenderEnded', function (e) {\r\n  \r\n        const underOverlaySlot = e.slot;\r\n  \r\n        if (\r\n            underOverlaySlot.getAdUnitPath() !== underOverlayUnitPath\r\n            && underOverlaySlot.getAdUnitPath() !== underOverlayC1UnitPath\r\n            && underOverlaySlot.getAdUnitPath() !== underOverlayC2UnitPath\r\n        ) return;\r\n        \r\n              // SP_overlayにて、リフレッシュ不可bidderが実際に配信された場合、以降のリフレッシュは行わない\r\n        if (underOverlaySlot.getAdUnitPath() === underOverlayUnitPath && e.campaignId === spPrebidOderId && refreshNgPrebidBidder) {\r\n          return;\r\n        }\r\n\r\n        console.log(`[FLUCT] getAdUnitPath: ${underOverlaySlot.getAdUnitPath()}, lineItemId: ${e.lineItemId}, creativeid: ${e.creativeId}`);\r\n  \r\n        // 更新できる最大数までリロードしたら、それ以上はリロードしない\r\n        fluct_current_refresh_num++;\r\n        if (fluct_current_refresh_num > MAX_REFRESH_NUM) return;\r\n  \r\n        if (deniedLineItemIds.includes(e.lineItemId)) return;\r\n        if (deniedCreativeIds.includes(e.creativeId)) return;\r\n  \r\n        console.log(`[FLUCT] under overlay shown. setUp setTimeout for RELOAD ad.`);\r\n  \r\n        setTimeout(function () {\r\n          console.log('[FLUCT] reload fired!');\r\n          // 上部オーバーレイが表示されていたらdestroyする。領域も隠す\r\n          const headOverlaySlot = googletag.pubads().getSlots().find((s) => s.getAdUnitPath() === headOverlayUnitPath);\r\n          if (headOverlaySlot) {\r\n            const globalHeader = document.querySelector('.js-global-header');\r\n            const headerAnchor = document.querySelector('.js-header-anker');\r\n            if (headerAnchor && globalHeader) {\r\n              globalHeader.classList.remove('header-GlobalHeader-anker');\r\n              headerAnchor.classList.remove('header-AnkerAd-visible');\r\n            }\r\n            googletag.destroySlots([headOverlaySlot]);\r\n            console.log('destroy: ', headOverlaySlot);\r\n            const headOverlayDiv = document.getElementById(headOverlayDivId);\r\n            if (headOverlayDiv) {\r\n              headOverlayDiv.remove();\r\n            }\r\n          }\r\n  \r\n          // imobileのクリエイティブはGAMのdivの直前に専用のdivを突っ込むため、refreshしてもアドが残り続けてしまう\r\n          // idがわかりやすいので、リロード前にDOMの存在を確認して削除する\r\n          const imOldAdDiv = document.getElementById('im_ov');\r\n          if (imOldAdDiv) {\r\n            imOldAdDiv.remove();\r\n          }\r\n  \r\n          // リロード時に全枠にKVをつける。上部オーバーレイにもリロード時につけたいので、setTimeoutの中でやる\r\n          googletag.pubads().setTargeting('refresh', 'refresh');\r\n  \r\n          // 下部オーバーレイをリロード。上部オーバーレイは既存の仕組みで表示が行われる\r\n          pbjs.requestBids({\r\n            bidsBackHandler: function () {\r\n              pbjs.setTargetingForGPTAsync([underOverlaySlot]);\r\n              googletag.pubads().refresh([underOverlaySlot]);\r\n            }\r\n          });\r\n        }, RELOAD_INTERVAL_SEC * 1000);\r\n      });\r\n    });\r\n  <\/script>\r\n  ",weight:1},{id:"be3ea4a9-3658-491d-93ad-a0696b489d9b",title:"【不使用】オーバーレイのリロード処理（下部オーバーレイ出し分け、回数制限、KV全枠付与、c2もリフレッシュ対象枠に追加）：~2025/05/07",tagText:"\x3c!-- BL: https://vg-ceg.backlog.com/view/FLUCT_PAM-3818 --\x3e\r\n<script>\r\n    window.googletag = window.googletag || { cmd: [] };\r\n    let fluct_current_refresh_num = 0;\r\n  \r\n    googletag.cmd.push(function () {\r\n      // 更新頻度の設定。秒で指定する\r\n      const RELOAD_INTERVAL_SEC = 0.84 * 60;\r\n      // 更新を実行する回数\r\n      const MAX_REFRESH_NUM = 3;\r\n  \r\n      const FirstLookLineItemIds = [\r\n        5643631150, 6329292705\r\n      ];\r\n  \r\n      const relaidoPrebidLineItemIds = [\r\n        5693952390, 5693952396, 5693952399, 5693953377, 5693953383, 5693958942, 5693958945, 5693958948, 5693958951, 5693958954,\r\n        5693958957, 5693959080, 5693959083, 5693959086, 5693959089, 5693959092, 5693959095, 5693959098, 5693959101, 5693959104,\r\n        5693959107, 5693959110, 5693959113, 5693959116, 5693959119, 5693959122, 5693959125, 5693959131, 5693959134, 5693959137,\r\n        5693959143, 5693959149, 5693959152, 5693959155, 5693959158, 5693959164, 5693959167, 5693959170, 5693959173, 5693959176,\r\n        5693959179, 5693959182, 5693959188, 5693959197, 5693959323, 5693959326, 5693959332, 5693959335, 5693959347, 5693959398,\r\n        5693959401, 5693959404, 5693959407, 5693959410, 5693959413, 5693959416, 5693959419, 5693959422, 5693959431, 5693959437,\r\n        5693959560, 5693959563, 5693959566, 5693959569, 5693959572, 5693959575, 5693959578, 5693959581, 5693959590, 5693959602,\r\n        5693959605, 5693959614, 5693959617, 5693959626, 5693959629, 5693959632, 5693959635, 5693959638, 5693959641, 5693959644,\r\n        5693959647, 5693959650, 5693959653, 5693959656, 5693959659, 5693959662, 5693959671, 5693959674, 5693959677, 5693959800,\r\n        5693959818, 5693959821, 5693959824, 5693959830, 5693959833, 5693959836, 5693959839, 5693959842, 5693959845, 5693959854,\r\n        5693959857, 5693959860, 5693959863, 5693959872, 5693959875, 5693959878, 5694974632, 5694974635, 5694974638, 5694982036,\r\n        5694982039, 5694982042, 5694982045, 5694982048, 5694982051, 5694982054, 5694982057, 5694982060, 5694982063, 5694982066,\r\n        5694982069, 5694982072, 5694982075, 5694982078, 5694982201, 5694982204, 5694982207, 5694982210, 5694982216, 5694982219,\r\n        5694982225, 5694982252, 5694982255, 5694982258, 5694982261, 5694982264, 5694982267, 5694982270, 5694982273, 5694982276,\r\n        5694982279, 5694982282, 5694982285, 5694982288, 5694982291, 5694982294, 5694982297, 5694982300, 5694982303, 5694982306,\r\n        5694982309, 5694982312, 5694982315, 5694983248, 5694983251, 5694983254, 5694983257, 5694983260, 5694983263, 5694983266,\r\n        5694983269, 5694983272, 5694983275, 5694983278, 5694983401, 5694983404, 5694983407, 5694983410, 5694983413, 5694983416,\r\n        5694983419, 5694983422, 5694983425, 5694983428, 5694983431, 5694983434, 5694983437, 5694983440, 5694983443, 5694983446,\r\n        5694983449, 5694983452, 5694983455, 5694983458, 5694983461, 5694983464, 5694983467, 5694983470, 5694983473, 5694983476,\r\n        5694983479, 5694983482, 5694983485, 5694983488, 5694983491, 5694983494, 5694983497, 5694983500, 5694983503, 5694983506,\r\n        5694983950, 5694983959, 5694983962, 5694983965, 5694983968, 5694983971, 5694983974, 5694983977, 5694983980, 5694983983,\r\n        5694983986, 5694983989, 5694983992, 5694983995, 5694983998, 5694984121, 5694984124, 5694984127, 5694984130, 5694984133,\r\n        5694984136, 5694984139, 5694984142, 5694984145, 5694984148, 5694984151, 5694984154, 5694984157, 5694984160, 5694984163,\r\n        5694984166, 5694984169, 5694984172, 5694984175, 5694984178, 5694984181, 5694984184, 5694984187, 5694984190, 5694984193,\r\n        5694984196, 5694984199, 5694984202, 5694984205, 5694984208, 5694984211, 5694984214, 5694984217, 5694984220, 5694984223,\r\n        5694984226, 5694984229, 5694984232, 5694984238, 5694984361, 5694984364, 5694984367, 5694984370, 5694984373, 5694984376,\r\n        5694984379, 5694984382, 5694984385, 5694984388, 5694984391, 5694984394, 5694984397, 5694984400, 5694984403, 5694984406,\r\n        5694984409, 5694984412, 5694984415, 5694984418, 5694984421, 5694984424, 5694984427, 5694984430, 5694984433, 5694984436,\r\n        5694984439, 5694984442, 5694984445, 5694984448, 5694984451, 5694984454, 5694984457, 5694984460, 5694984463, 5694984466,\r\n        5694984469, 5694984472, 5694984475, 5694984478, 5694984601, 5694984604, 5694984607, 5694984610, 5695551587, 5695551590,\r\n        5695551593, 5695551596, 5695551599, 5695551722, 5695551728, 5695551731, 5695551734, 5695551737, 5695551740, 5695551743,\r\n        5695551746, 5695551749, 5695551752, 5695551755, 5695551758, 5695551761, 5695551764, 5695551770, 5695551773, 5695551776,\r\n        5695551779, 5695551782, 5695551785, 5695551788, 5695551791, 5695551797, 5695551800, 5695551803, 5695551806, 5693952393,\r\n        5693953380, 5693959128, 5693959140, 5693959146, 5693959161, 5693959185, 5693959191, 5693959194, 5693959320, 5693959329,\r\n        5693959338, 5693959344, 5693959350, 5693959353, 5693959356, 5693959359, 5693959362, 5693959365, 5693959368, 5693959371,\r\n        5693959374, 5693959377, 5693959380, 5693959383, 5693959386, 5693959389, 5693959392, 5693959395, 5693959425, 5693959428,\r\n        5693959434, 5693959584, 5693959587, 5693959593, 5693959596, 5693959599, 5693959608, 5693959611, 5693959620, 5693959623,\r\n        5693959665, 5693959668, 5693959803, 5693959806, 5693959809, 5693959812, 5693959815, 5693959827, 5693959848, 5693959851,\r\n        5693959866, 5693959869, 5693959881, 5693959884, 5693959887, 5693959890, 5693959893, 5693959896, 5693959899, 5693959902,\r\n        5693959905, 5693959908, 5693959911, 5693959914, 5693959917, 5693960040, 5693960043, 5693960046, 5693960049, 5693960052,\r\n        5693960055, 5693960058, 5694982213, 5694982222, 5694982228, 5694982231, 5694982234, 5694982237, 5694982240, 5694982243,\r\n        5694982246, 5694982249, 5694983908, 5694983911, 5694983914, 5694983917, 5694983920, 5694983923, 5694983926, 5694983929,\r\n        5694983932, 5694983935, 5694983938, 5694983941, 5694983944, 5694983947, 5694983953, 5694983956, 5695551725, 5695551767,\r\n        5695551794\r\n      ]\r\n  \r\n      // 以下の広告申込情報ID及びクリエイティブIDが引きあたったときはリロードを行わない\r\n      const deniedLineItemIds = [...FirstLookLineItemIds, ...relaidoPrebidLineItemIds]\r\n  \r\n      const deniedCreativeIds = [\r\n        138365235629, 138380805199,\r\n      ];\r\n  \r\n      const underOverlayUnitPath = '/21763395206/overlay/SP_overlay';\r\n      const underOverlayC1UnitPath = '/21763395206/overlay/SP_overlay_c1';\r\n      const underOverlayC2UnitPath = '/21763395206/overlay/SP_overlay_c2';\r\n      const headOverlayUnitPath = '/21763395206/sp_all/SP_header_anchor';\r\n      const headOverlayDivId = 'div-gpt-ad-1676254477673-0';\r\n  \r\n      // slotRenderEndedを使い、下部オーバーレイが表示されるたびに再読み込みの登録を行う\r\n      googletag.pubads().addEventListener('slotRenderEnded', function (e) {\r\n  \r\n        const underOverlaySlot = e.slot;\r\n  \r\n        if (\r\n            underOverlaySlot.getAdUnitPath() !== underOverlayUnitPath\r\n            && underOverlaySlot.getAdUnitPath() !== underOverlayC1UnitPath\r\n            && underOverlaySlot.getAdUnitPath() !== underOverlayC2UnitPath\r\n        ) return;\r\n        console.log(`[FLUCT] getAdUnitPath: ${underOverlaySlot.getAdUnitPath()}, lineItemId: ${e.lineItemId}, creativeid: ${e.creativeId}`);\r\n  \r\n        // 更新できる最大数までリロードしたら、それ以上はリロードしない\r\n        fluct_current_refresh_num++;\r\n        if (fluct_current_refresh_num > MAX_REFRESH_NUM) return;\r\n  \r\n        if (deniedLineItemIds.includes(e.lineItemId)) return;\r\n        if (deniedCreativeIds.includes(e.creativeId)) return;\r\n  \r\n        console.log(`[FLUCT] under overlay shown. setUp setTimeout for RELOAD ad.`);\r\n  \r\n        setTimeout(function () {\r\n          console.log('[FLUCT] reload fired!');\r\n          // 上部オーバーレイが表示されていたらdestroyする。領域も隠す\r\n          const headOverlaySlot = googletag.pubads().getSlots().find((s) => s.getAdUnitPath() === headOverlayUnitPath);\r\n          if (headOverlaySlot) {\r\n            const globalHeader = document.querySelector('.js-global-header');\r\n            const headerAnchor = document.querySelector('.js-header-anker');\r\n            if (headerAnchor && globalHeader) {\r\n              globalHeader.classList.remove('header-GlobalHeader-anker');\r\n              headerAnchor.classList.remove('header-AnkerAd-visible');\r\n            }\r\n            googletag.destroySlots([headOverlaySlot]);\r\n            console.log('destroy: ', headOverlaySlot);\r\n            const headOverlayDiv = document.getElementById(headOverlayDivId);\r\n            if (headOverlayDiv) {\r\n              headOverlayDiv.remove();\r\n            }\r\n          }\r\n  \r\n          // imobileのクリエイティブはGAMのdivの直前に専用のdivを突っ込むため、refreshしてもアドが残り続けてしまう\r\n          // idがわかりやすいので、リロード前にDOMの存在を確認して削除する\r\n          const imOldAdDiv = document.getElementById('im_ov');\r\n          if (imOldAdDiv) {\r\n            imOldAdDiv.remove();\r\n          }\r\n  \r\n          // リロード時に全枠にKVをつける。上部オーバーレイにもリロード時につけたいので、setTimeoutの中でやる\r\n          googletag.pubads().setTargeting('refresh', 'refresh');\r\n  \r\n          // 下部オーバーレイをリロード。上部オーバーレイは既存の仕組みで表示が行われる\r\n          pbjs.requestBids({\r\n            bidsBackHandler: function () {\r\n              pbjs.setTargetingForGPTAsync([underOverlaySlot]);\r\n              googletag.pubads().refresh([underOverlaySlot]);\r\n            }\r\n          });\r\n        }, RELOAD_INTERVAL_SEC * 1000);\r\n      });\r\n    });\r\n  <\/script>\r\n  ",weight:0},{id:"bb60e9ba-ad5f-45f7-ab1f-abd7a4a89f5f",title:"【不使用】オーバーレイのリロード処理（下部オーバーレイ出し分け、回数制限、KV全枠付与）：〜2025/04/18",tagText:"\x3c!-- BL: https://vg-ceg.backlog.com/view/FLUCT_PAM-3818 --\x3e\r\n<script>\r\n    window.googletag = window.googletag || { cmd: [] };\r\n    let fluct_current_refresh_num = 0;\r\n  \r\n    googletag.cmd.push(function () {\r\n      // 更新頻度の設定。秒で指定する\r\n      const RELOAD_INTERVAL_SEC = 0.84 * 60;\r\n      // 更新を実行する回数\r\n      const MAX_REFRESH_NUM = 3;\r\n  \r\n      const FirstLookLineItemIds = [\r\n        5643631150, 6329292705\r\n      ];\r\n  \r\n      const relaidoPrebidLineItemIds = [\r\n        5693952390, 5693952396, 5693952399, 5693953377, 5693953383, 5693958942, 5693958945, 5693958948, 5693958951, 5693958954,\r\n        5693958957, 5693959080, 5693959083, 5693959086, 5693959089, 5693959092, 5693959095, 5693959098, 5693959101, 5693959104,\r\n        5693959107, 5693959110, 5693959113, 5693959116, 5693959119, 5693959122, 5693959125, 5693959131, 5693959134, 5693959137,\r\n        5693959143, 5693959149, 5693959152, 5693959155, 5693959158, 5693959164, 5693959167, 5693959170, 5693959173, 5693959176,\r\n        5693959179, 5693959182, 5693959188, 5693959197, 5693959323, 5693959326, 5693959332, 5693959335, 5693959347, 5693959398,\r\n        5693959401, 5693959404, 5693959407, 5693959410, 5693959413, 5693959416, 5693959419, 5693959422, 5693959431, 5693959437,\r\n        5693959560, 5693959563, 5693959566, 5693959569, 5693959572, 5693959575, 5693959578, 5693959581, 5693959590, 5693959602,\r\n        5693959605, 5693959614, 5693959617, 5693959626, 5693959629, 5693959632, 5693959635, 5693959638, 5693959641, 5693959644,\r\n        5693959647, 5693959650, 5693959653, 5693959656, 5693959659, 5693959662, 5693959671, 5693959674, 5693959677, 5693959800,\r\n        5693959818, 5693959821, 5693959824, 5693959830, 5693959833, 5693959836, 5693959839, 5693959842, 5693959845, 5693959854,\r\n        5693959857, 5693959860, 5693959863, 5693959872, 5693959875, 5693959878, 5694974632, 5694974635, 5694974638, 5694982036,\r\n        5694982039, 5694982042, 5694982045, 5694982048, 5694982051, 5694982054, 5694982057, 5694982060, 5694982063, 5694982066,\r\n        5694982069, 5694982072, 5694982075, 5694982078, 5694982201, 5694982204, 5694982207, 5694982210, 5694982216, 5694982219,\r\n        5694982225, 5694982252, 5694982255, 5694982258, 5694982261, 5694982264, 5694982267, 5694982270, 5694982273, 5694982276,\r\n        5694982279, 5694982282, 5694982285, 5694982288, 5694982291, 5694982294, 5694982297, 5694982300, 5694982303, 5694982306,\r\n        5694982309, 5694982312, 5694982315, 5694983248, 5694983251, 5694983254, 5694983257, 5694983260, 5694983263, 5694983266,\r\n        5694983269, 5694983272, 5694983275, 5694983278, 5694983401, 5694983404, 5694983407, 5694983410, 5694983413, 5694983416,\r\n        5694983419, 5694983422, 5694983425, 5694983428, 5694983431, 5694983434, 5694983437, 5694983440, 5694983443, 5694983446,\r\n        5694983449, 5694983452, 5694983455, 5694983458, 5694983461, 5694983464, 5694983467, 5694983470, 5694983473, 5694983476,\r\n        5694983479, 5694983482, 5694983485, 5694983488, 5694983491, 5694983494, 5694983497, 5694983500, 5694983503, 5694983506,\r\n        5694983950, 5694983959, 5694983962, 5694983965, 5694983968, 5694983971, 5694983974, 5694983977, 5694983980, 5694983983,\r\n        5694983986, 5694983989, 5694983992, 5694983995, 5694983998, 5694984121, 5694984124, 5694984127, 5694984130, 5694984133,\r\n        5694984136, 5694984139, 5694984142, 5694984145, 5694984148, 5694984151, 5694984154, 5694984157, 5694984160, 5694984163,\r\n        5694984166, 5694984169, 5694984172, 5694984175, 5694984178, 5694984181, 5694984184, 5694984187, 5694984190, 5694984193,\r\n        5694984196, 5694984199, 5694984202, 5694984205, 5694984208, 5694984211, 5694984214, 5694984217, 5694984220, 5694984223,\r\n        5694984226, 5694984229, 5694984232, 5694984238, 5694984361, 5694984364, 5694984367, 5694984370, 5694984373, 5694984376,\r\n        5694984379, 5694984382, 5694984385, 5694984388, 5694984391, 5694984394, 5694984397, 5694984400, 5694984403, 5694984406,\r\n        5694984409, 5694984412, 5694984415, 5694984418, 5694984421, 5694984424, 5694984427, 5694984430, 5694984433, 5694984436,\r\n        5694984439, 5694984442, 5694984445, 5694984448, 5694984451, 5694984454, 5694984457, 5694984460, 5694984463, 5694984466,\r\n        5694984469, 5694984472, 5694984475, 5694984478, 5694984601, 5694984604, 5694984607, 5694984610, 5695551587, 5695551590,\r\n        5695551593, 5695551596, 5695551599, 5695551722, 5695551728, 5695551731, 5695551734, 5695551737, 5695551740, 5695551743,\r\n        5695551746, 5695551749, 5695551752, 5695551755, 5695551758, 5695551761, 5695551764, 5695551770, 5695551773, 5695551776,\r\n        5695551779, 5695551782, 5695551785, 5695551788, 5695551791, 5695551797, 5695551800, 5695551803, 5695551806, 5693952393,\r\n        5693953380, 5693959128, 5693959140, 5693959146, 5693959161, 5693959185, 5693959191, 5693959194, 5693959320, 5693959329,\r\n        5693959338, 5693959344, 5693959350, 5693959353, 5693959356, 5693959359, 5693959362, 5693959365, 5693959368, 5693959371,\r\n        5693959374, 5693959377, 5693959380, 5693959383, 5693959386, 5693959389, 5693959392, 5693959395, 5693959425, 5693959428,\r\n        5693959434, 5693959584, 5693959587, 5693959593, 5693959596, 5693959599, 5693959608, 5693959611, 5693959620, 5693959623,\r\n        5693959665, 5693959668, 5693959803, 5693959806, 5693959809, 5693959812, 5693959815, 5693959827, 5693959848, 5693959851,\r\n        5693959866, 5693959869, 5693959881, 5693959884, 5693959887, 5693959890, 5693959893, 5693959896, 5693959899, 5693959902,\r\n        5693959905, 5693959908, 5693959911, 5693959914, 5693959917, 5693960040, 5693960043, 5693960046, 5693960049, 5693960052,\r\n        5693960055, 5693960058, 5694982213, 5694982222, 5694982228, 5694982231, 5694982234, 5694982237, 5694982240, 5694982243,\r\n        5694982246, 5694982249, 5694983908, 5694983911, 5694983914, 5694983917, 5694983920, 5694983923, 5694983926, 5694983929,\r\n        5694983932, 5694983935, 5694983938, 5694983941, 5694983944, 5694983947, 5694983953, 5694983956, 5695551725, 5695551767,\r\n        5695551794\r\n      ]\r\n  \r\n      // 以下の広告申込情報ID及びクリエイティブIDが引きあたったときはリロードを行わない\r\n      const deniedLineItemIds = [...FirstLookLineItemIds, ...relaidoPrebidLineItemIds]\r\n  \r\n      const deniedCreativeIds = [\r\n        138365235629, 138380805199,\r\n      ];\r\n  \r\n      const underOverlayUnitPath = '/21763395206/overlay/SP_overlay';\r\n      const underOverlayC1UnitPath = '/21763395206/overlay/SP_overlay_c1';\r\n      const headOverlayUnitPath = '/21763395206/sp_all/SP_header_anchor';\r\n      const headOverlayDivId = 'div-gpt-ad-1676254477673-0';\r\n  \r\n      // slotRenderEndedを使い、下部オーバーレイが表示されるたびに再読み込みの登録を行う\r\n      googletag.pubads().addEventListener('slotRenderEnded', function (e) {\r\n  \r\n        const underOverlaySlot = e.slot;\r\n  \r\n        if (\r\n            underOverlaySlot.getAdUnitPath() !== underOverlayUnitPath\r\n            && underOverlaySlot.getAdUnitPath() !== underOverlayC1UnitPath\r\n        ) return;\r\n        console.log(`[FLUCT] getAdUnitPath: ${underOverlaySlot.getAdUnitPath()}, lineItemId: ${e.lineItemId}, creativeid: ${e.creativeId}`);\r\n  \r\n        // 更新できる最大数までリロードしたら、それ以上はリロードしない\r\n        fluct_current_refresh_num++;\r\n        if (fluct_current_refresh_num > MAX_REFRESH_NUM) return;\r\n  \r\n        if (deniedLineItemIds.includes(e.lineItemId)) return;\r\n        if (deniedCreativeIds.includes(e.creativeId)) return;\r\n  \r\n        console.log(`[FLUCT] under overlay shown. setUp setTimeout for RELOAD ad.`);\r\n  \r\n        setTimeout(function () {\r\n          console.log('[FLUCT] reload fired!');\r\n          // 上部オーバーレイが表示されていたらdestroyする。領域も隠す\r\n          const headOverlaySlot = googletag.pubads().getSlots().find((s) => s.getAdUnitPath() === headOverlayUnitPath);\r\n          if (headOverlaySlot) {\r\n            const globalHeader = document.querySelector('.js-global-header');\r\n            const headerAnchor = document.querySelector('.js-header-anker');\r\n            if (headerAnchor && globalHeader) {\r\n              globalHeader.classList.remove('header-GlobalHeader-anker');\r\n              headerAnchor.classList.remove('header-AnkerAd-visible');\r\n            }\r\n            googletag.destroySlots([headOverlaySlot]);\r\n            console.log('destroy: ', headOverlaySlot);\r\n            const headOverlayDiv = document.getElementById(headOverlayDivId);\r\n            if (headOverlayDiv) {\r\n              headOverlayDiv.remove();\r\n            }\r\n          }\r\n  \r\n          // imobileのクリエイティブはGAMのdivの直前に専用のdivを突っ込むため、refreshしてもアドが残り続けてしまう\r\n          // idがわかりやすいので、リロード前にDOMの存在を確認して削除する\r\n          const imOldAdDiv = document.getElementById('im_ov');\r\n          if (imOldAdDiv) {\r\n            imOldAdDiv.remove();\r\n          }\r\n  \r\n          // リロード時に全枠にKVをつける。上部オーバーレイにもリロード時につけたいので、setTimeoutの中でやる\r\n          googletag.pubads().setTargeting('refresh', 'refresh');\r\n  \r\n          // 下部オーバーレイをリロード。上部オーバーレイは既存の仕組みで表示が行われる\r\n          pbjs.requestBids({\r\n            bidsBackHandler: function () {\r\n              pbjs.setTargetingForGPTAsync([underOverlaySlot]);\r\n              googletag.pubads().refresh([underOverlaySlot]);\r\n            }\r\n          });\r\n        }, RELOAD_INTERVAL_SEC * 1000);\r\n      });\r\n    });\r\n  <\/script>\r\n  ",weight:0}]},{id:"a2f00915-1c79-40f4-ae42-fc62a8fa2ca1",title:"新しい比率出し分け親",components:[]}],triggerEnabled:!0},{id:"128c070b-e069-4341-bd78-3818d621a042",title:"【テスト環境とarticles/1027207でのみ稼働中】PCテスト用トリガー",condition:{url:{patterns:[{type:"string",value:"trilltrill-dev"},{type:"string",value:"articles/1027207"}]},device:{kind:"pc"}},weightedParents:[{id:"f0bb63ac-1395-4bc6-901c-dbdf9c8dcd6f",title:"PCオーバーレイ",components:[{id:"78544c82-86dc-4eb3-a206-d21c11879c36",title:"PCオーバーレイ",tagText:"<script async=\"\" src=\"https://fam.adingo.jp/bid-strap/trill/pb.js\"><\/script>\n<script>\n    var bsttag = window.bsttag || {\n        cmd: []\n    };\n\n    bsttag.failSafeTimeout = 3000;\n    bsttag.launchAuction = function (slots) {\n        var hbm = {};\n        bsttag.cmd.push(function (cmd) {\n            hbm = cmd.requestBids({\n                adUnits: slots\n            });\n        });\n\n        setTimeout(function () {\n            if (hbm.isRequestSent) {\n                return;\n            }\n\n            hbm.isRequestSent = true;\n            googletag.cmd.push(function () {\n                googletag.pubads().refresh(slots);\n            });\n        }, bsttag.failSafeTimeout);\n    }\n        ;\n<\/script>\n\n<script>\n    let pcOverlayCurrentRefreshCounts = 0\n    const PC_OVERLAY_MAX_REFRESH_COUNTS = 3;\n\n    googletag.cmd.push(\n        () => {\n            const pcOverlaySlot = googletag.defineSlot('/21763395206/overlay/PC_overlay', [[1, 1], [728, 90], 'fluid'], 'div-gpt-ad-1617861038843-0').addService(googletag.pubads());\n\n            const deniedRefreshLineItemIds = [6978157856];\n            const deniedRefreshPrebidBidder = ['fluct', 'criteo', 'rubicon', 'yieldone', 'appnexus']; //テスト用、本来はfluctのみ\n            const pcPrebidOderId = 2980451755;\n\n            let refreshOkPrebidBidder;\n\n            // slotRequestedは確実にslotRenderEndedより先に発生する\n            // slotRequestedの時点で勝者bidderがリフレッシュ可能なbidderであるかをチェックする\n            googletag.pubads().addEventListener('slotRequested', (event) => {\n                const slot = event.slot\n                if(slot !== pcOverlaySlot){\n                    return;\n                }\n                console.log('slotRequested', slot.getAdUnitPath());\n                // slot.getTargeting('fbs_bidder')の戻り値は勝者bidderの名前が1つのみ格納された、または空のArrayとなる\n                // 例: ['criteo']\n                const winPrebidBidder = slot.getTargeting('fbs_bidder')[0];\n                console.log('slotRequested', 'winPrebidBidder', winPrebidBidder);\n                refreshOkPrebidBidder = deniedRefreshPrebidBidder.includes(winPrebidBidder) ? false : true;\n                console.log('slotRequested','refreshOkPrebidBidder?', refreshOkPrebidBidder);\n            })\n\n            googletag.pubads().addEventListener('slotRenderEnded', (event) => {\n                // リフレッシュ不可bidderが実際に配信された場合、以降のリフレッシュは行わない\n                if(event.campaignId === pcPrebidOderId && !refreshOkPrebidBidder){\n                  console.log('Denied prebid bidder rendered. Stop Refreshing.')\n                    return;\n                }\n                if (pcOverlayCurrentRefreshCounts >= PC_OVERLAY_MAX_REFRESH_COUNTS) {\n                    return;\n                }\n                if (deniedRefreshLineItemIds.includes(event.lineItemId)) {\n                    return\n                }\n                if (event.slot === pcOverlaySlot) {\n                    console.log('slotRenderEnded', event.slot.getAdUnitPath());\n                    console.log('slotRenderEnded', 'prebidLineItemRendered?', event.campaignId === pcPrebidOderId);\n                    const refresh = function () {\n                        bsttag.launchAuction([pcOverlaySlot]);\n                        pcOverlayCurrentRefreshCounts++;\n                    };\n                    setTimeout(refresh, 10000); // 検証用、本来は30000\n                }\n            })\n            bsttag.launchAuction([pcOverlaySlot]);\n        }\n    )\n<\/script>\n",weight:1}]}],triggerEnabled:!0}]}},_="fluct_one_debug";try{!function(){window.fluctOneScript=window.fluctOneScript||{},window.fluctOneScript.config=O,window.fluctOneScript.enableDebugMode=()=>{o.setDebugMode(!0),function(e,n){try{return localStorage.setItem(e,n)}catch(e){return}}(_,"true")};const e=S(_)||function(e){try{return localStorage.getItem(e)}catch(e){return null}}(_)||"false";o.setDebugMode("true"===e),o.setContextProperty("siteId",O.site.id),o.setContextProperty("siteCode",O.site.siteCode)}(),function(){const e=S("fluct_one_preview");!e||window.fluctOneScript.enablePreview?O.site.triggers.forEach((e=>{m(e.condition)&&e.weightedParents.forEach((n=>{const t=p(n);t&&(y(t.tagText),o.info(`trigger ${e.id} (${e.title}) fired, write tag component ${t.id} (${t.title}).`,{triggerId:e.id,triggerTitle:e.title,condition:e.condition,component:t},100))}))})):(window.fluctOneScript.enablePreview=!0,function(e,n=document){if(b(n))document.write(`<script src="${e}"><\/script>`);else{const n=document.createElement("script");n.src=e,n.async=!0,document.head.appendChild(n)}}(`${document.currentScript.src}?onePreview=${e}`))}()}catch(e){e instanceof Error?o.error(`${e.message}`,e):o.error("Unknown Error",{error:e})}}();
