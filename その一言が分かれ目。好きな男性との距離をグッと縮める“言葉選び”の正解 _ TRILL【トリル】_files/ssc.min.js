"use strict";!function(e,n){e[n]=e[n]||[],e[n].param=e[n].param||[];var t,r,a,i=e[n].param.shift();function o(e){try{window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"set_dc_ssc_id",dc_ssc_id:e}),i.sscCallback&&i.sscCallback(e)}catch(e){c("error",["SSC Callback Error -",e])}}function c(e,n){i.debugMode&&(e=e||"log",n=["[SSC-MODULE-DEBUG]:"].concat(n).join(" "),console[e](n))}function s(){var e,n,t,r=(function(e){for(var n=document.cookie.split(";"),t=0;t<n.length;t++){var r=n[t].trim().split("=");if(r[0]===e)return decodeURIComponent(r[1])}return null}(i.sscCookiename)||"").match(/^([0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12})_([0-9a-f]+)\.([0-9a-z+/]{43}={0,2})$/i);return r?(e=r[1],n=r[2],r=r[3],n=n,t=24*i.sscidExpDays*60*60*1e3,n=parseInt(n,16)+t,t=Date.now(),c("log",["SSCID: Expire Date -",new Date(n)]),t<n?(c("log",["SSCID: Get from Cookie -",e]),[e,r]):(c("log",["SSCID: Expired"]),[null,null])):(c("log",["SSCID: Not defined in cookie"]),[
null,null])}function l(e,n){var t,r,a=function(){switch(n){case"storage":return!0;case"fetch":return!1;default:return!0}}();try{if(!e)return c("log",["xDomainFile: Not defined in",n]),null;if(a&&(t=e.createdAt,r=24*i.xDomainFileExpDays*60*60*1e3,t=Number(t)+r,r=Date.now(),c("log",["xDomainFile: Expire Date -",new Date(t)]),!(r<t)))return c("log",["xDomainFile: Expired"]),null;if(!Array.isArray(e.sets))return c("log",["xDomainFile: Unexpected format"]),null}catch(e){return c("error",["xDomainFile: check Error -",e]),null}return e}function u(){return c("log",["xDomainFile: Update"]),fetch("https://"+i.endpoint+i.xDomainFilePath,{method:"GET",mode:"same-origin"}).then(function(e){if(e.ok)return e.json();throw new Error(e.status)}).then(function(e){if(!(t=l(e,"fetch")))throw new Error("Failed to retrieve");t=function(e){if(i.disableExternalLink)return null;e.createdAt=Date.now();var n=JSON.stringify(e);return localStorage.setItem(i.xDomainStorageID,n),c("log",[
"xDomainFile: Set to localStorage:",i.xDomainStorageID,n]),e}(t)}).catch(function(e){throw new Error("xDomainFile: Request Error - "+e)})}function d(e,n,t){function r(a,o,e){var n=e.map(function(e){return e.replace(/\/$/,"")});Array.prototype.filter.call(document.getElementsByTagName("a"),function(e){return!(-1<e.search.indexOf(i.exLinkQueryPath+"="))&&e.hostname!==location.hostname&&-1<n.indexOf(e.protocol+"//"+e.hostname)}).forEach(function(e){var n=e.pathname.replace(/^\//,""),t=e.search.substring(1),r=[a,o].join(".");e.pathname=i.sscRedirectPath,e.search=["?",i.exLinkQuerySig,"=",encodeURIComponent(r),"&",i.exLinkQueryPath,"=",encodeURIComponent(n),"&",i.exLinkQueryDomain,"=",encodeURIComponent(location.hostname),"&",t].join(""),c("log",["Element rewrited:",e.href])})}var a=function(e){try{return e.sets[0].associatedSites}catch(e){return[]}}(t);"complete"===document.readyState?r(e,n,a):(c("log",["Set rewriter Event"]),window.addEventListener("load",function(){r(e,n,a)}))}e[n
].getSscId=function(){return r},e[n].updateLinkTags=function(){r&&a&&!i.disableExternalLink&&t&&d(r,a,t)},navigator.cookieEnabled?(i.debugMode=i.debugMode||!1,i.sscCookiename=i.sscCookiename||"dc_ssc_idsig",i.sscPath=i.sscPath||"/ssc",i.sscRedirectPath=i.sscRedirectPath||"/sscrd",i.sscidExpDays=Number(i.sscidExpDays)||100,i.disableExternalLink=i.disableExternalLink||!1,i.xDomainStorageID=i.xDomainStorageID||"dc_ssc_xdomains",i.xDomainFilePath=i.xDomainFilePath||"/dc-ssc/ssc-xdomain-set.json",i.xDomainFileExpDays=Number(i.xDomainFileExpDays)||7,i.exLinkQueryPath=i.exLinkQueryPath||"_dcpath",i.exLinkQueryDomain=i.exLinkQueryDomain||"_dcdomain",i.exLinkQuerySig=i.exLinkQuerySig||"_dcidsig",i.sscCallback="function"==typeof i.sscCallback?i.sscCallback:null,c("log",["Start"]),e=s(),r=e[0],a=e[1],r&&a&&o(r),t=function(){if(i.disableExternalLink)return null;var e=null;try{e=l(e=JSON.parse(localStorage.getItem(i.xDomainStorageID)),"storage")}catch(e){return null}return e&&c("log",[
"xDomainFile: Get From Storage",i.xDomainStorageID,JSON.stringify(e)]),e}(),r&&a?i.disableExternalLink||t?!i.disableExternalLink&&t&&d(r,a,t):u().then(function(){t&&d(r,a,t)}).catch(function(e){c("error",e)}):(c("log",["SSCID: Update"]),fetch("https://"+i.endpoint+i.sscPath,{method:"POST",mode:"same-origin"}).then(function(e){if(!e.ok)throw new Error(e.status);var n=s();if(r=n[0],a=n[1],r&&a)return o(r),e;throw new Error("Failed to retrieve")}).catch(function(e){throw o(r),new Error("SSCID: Request Error - "+e)}).then(function(){if(!i.disableExternalLink&&!t)return u()}).then(function(){t&&d(r,a,t)}).catch(function(e){c("error",e)}))):o(r=null)}(window,"DC_SSC_MODULE");
